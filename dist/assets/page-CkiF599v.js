import{a as v,r as n,G as j,H as y,j as e,I as R,M as N,J as u,K as x,N as w,O as S}from"./index-0LaFy2cp.js";function D({params:{matchId:p}}){const{rtMatch:a,rtMatchCurrentRound:s,rtMatchCurrentRoundDoras:f}=v(p),r=n.useMemo(()=>{if(!a||!s)return[];const t=j([s.playerResults[0].afterScore,s.playerResults[1].afterScore,s.playerResults[2].afterScore,s.playerResults[3].afterScore]);return["0","1","2","3"].map((l,g)=>({...a.players[l],color:a.players[l].color,currentStatus:{...s.playerResults[l],isEast:y(l,s.roundCount),...t[g]}}))},[a,s]),[i,c]=n.useState(null),[o,h]=n.useState(),[d,m]=n.useState({0:!1,1:!1,2:!1,3:!1});return n.useEffect(()=>{["0","1","2","3"].forEach(t=>{typeof(s==null?void 0:s.playerResults[t].isRiichi)<"u"&&s.playerResults[t].isRiichi!==d[t]&&(s.playerResults[t].isRiichi===!0&&(c(t),setTimeout(()=>{c(null)},2800)),m(l=>({...l,[t]:s.playerResults[t].isRiichi})))})},[s==null?void 0:s.playerResults,d]),n.useEffect(()=>{o!==(s==null?void 0:s.code)&&(h(s==null?void 0:s.code),m({0:!1,1:!1,2:!1,3:!1}))},[s==null?void 0:s.code,o]),!a||!s?e.jsx("div",{className:"text-current",children:"對局讀取失敗。"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute inset-0 mx-auto py-8 overflow-hidden text-[4.8rem] transition-opacity",style:{background:"linear-gradient(transparent, transparent 73%, rgba(0, 0, 0, 0.4))",opacity:i!==null?0:1},children:[e.jsxs("div",{className:"flex flex-row items-stretch gap-x-4 text-white",children:[e.jsxs("div",{className:"relative text-[0.6em] p-2 pl-10 pr-[1em] flex items-center gap-x-8",style:{transition:"width 0.3s, left 1.5s, opacity 1.5s",left:a.hideHeader?"-100%":"0",opacity:a.hideHeader?"0":"1",background:"linear-gradient(280deg, transparent, transparent 0.5em, #00000080 0.5em, #00000080 100%)"},children:[e.jsxs("div",{className:"",children:[e.jsx("div",{className:"text-[0.5em]",children:a.name}),e.jsxs("div",{className:"flex gap-x-8 items-center",children:[e.jsx("div",{className:"min-w-[3.5em]",children:e.jsx(R,{roundCount:s.roundCount,max:8})}),e.jsxs("div",{className:"flex flex-col justify-around gap-2",children:[e.jsxs("div",{className:"flex-1 flex flex-row items-center gap-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("img",{src:"/images/score-hundred.png",alt:"hundred",className:"h-[0.25em] mt-[0.1em]"})}),e.jsx("div",{className:"text-[0.45em] leading-none",children:s.extendedRoundCount??0})]}),e.jsxs("div",{className:"flex-1 flex flex-row items-center gap-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("img",{src:"/images/score-thousand.png",alt:"thousand",className:"h-[0.25em] mt-[0.1em]"})}),e.jsx("div",{className:"text-[0.45em] leading-none",children:s.cumulatedThousands??0})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-x-2",children:f.map(t=>e.jsx(N,{className:"w-[1.4em]! animate-[fadeInFromLeft_0.5s_ease-in-out]",children:t},t))})]}),e.jsx("div",{className:"flex-1"})]}),e.jsx("div",{className:"flex items-center justify-center mt-20",children:e.jsx("div",{className:"body-hidden mx-20 text-[16px]"})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 px-10 pb-6 grid grid-cols-4 items-end gap-x-8 text-white animate-[fadeInFromBottom_1s_ease-in-out]",style:{opacity:a.activeResultDetail||a.hidePlayers?0:1,bottom:a.activeResultDetail||a.hidePlayers?"-150px":0,transition:"opacity 0.5s, bottom 0.5s"},children:r.map(t=>e.jsxs("div",{className:"w-[5.35em]",children:[e.jsx(u,{player:t,playerIndex:"0",score:t.currentStatus.afterScore,scoreChanges:t.currentStatus.scoreChanges,isEast:t.currentStatus.isEast,isRiichi:t.currentStatus.isRiichi&&s.resultType===x.Unknown,waitingTiles:s.resultType===x.Unknown?t.currentStatus.waitingTiles:[],isYellowCarded:t.currentStatus.isYellowCarded,isRedCarded:t.currentStatus.isRedCarded,isRonDisallowed:t.currentStatus.isRonDisallowed,ranking:t.currentStatus.ranking,point:t.currentStatus.point,showPointAndRanking:!!a.showPoints}),e.jsx("img",{src:t.largeLogoUrl,className:"w-0 h-0"})]},t.primaryName))}),a.activeResultDetail&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 px-10 pb-6 grid grid-cols-4 gap-x-8 text-white transition-opacity animate-[fadeInFromBottom_1s_ease-in-out]",children:[e.jsx("div",{className:"w-[5.35em]",children:e.jsx(u,{player:a.players[a.activeResultDetail.winnerPlayerIndex],playerIndex:"0",score:s.playerResults[a.activeResultDetail.winnerPlayerIndex].afterScore})}),e.jsxs("div",{className:"col-span-3 bg-black bg-opacity-50 py-6 px-8 text-[0.5em] flex items-stretch gap-x-4",children:[e.jsx("div",{className:`flex-1 flex flex-wrap gap-x-[0.75em] ${a.activeResultDetail.yakumanCount>0?"self-center justify-center":""}`,children:a.activeResultDetail.yakus.map(({label:t})=>e.jsx("span",{children:t},t))}),e.jsx("div",{className:"shrink-0 w-px bg-neutral-200"}),e.jsx("div",{className:"shrink-0 min-w-[3em] self-center text-green-400 text-[1.4em] text-center",children:e.jsx(w,{han:a.activeResultDetail.han,fu:a.activeResultDetail.fu,yakumanCount:a.activeResultDetail.yakumanCount})})]})]})]}),e.jsx("div",{className:"absolute top-0 bottom-0 left-0 right-0 pointer-events-none",children:e.jsx(S,{active:i!==null,color:i&&r[i].color,largeLogoUrl:i&&r[i].largeLogoUrl})})]})}export{D as default};
