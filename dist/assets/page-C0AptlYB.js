import{_ as v,r as N,R as A,j as a,g as X,s as M,b as De,u as K,k as we,M as Ie,c as me,d as Te,e as Fe,f as $e,h as ue,l as Le,C as he,m as Ue,o as ze,p as Oe,q as He,t as Ve}from"./index-0LaFy2cp.js";import{o as fe,b as qe,s as R,u as Ge}from"./useCurrentTournament-Dp40AeN5.js";import{b as Me}from"./match.service-BrE1O46H.js";function P(e,t){if(e==null)return{};var s={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;s[r]=e[r]}return s}var D=255,E=100,$=e=>{var{r:t,g:s,b:r,a:d}=e,n=Math.max(t,s,r),l=n-Math.min(t,s,r),c=l?n===t?(s-r)/l:n===s?2+(r-t)/l:4+(t-s)/l:0;return{h:60*(c<0?c+6:c),s:n?l/n*E:0,v:n/D*E,a:d}},Ce=e=>{var{h:t,s,l:r,a:d}=Se(e);return"hsla("+t+", "+s+"%, "+r+"%, "+d+")"},Se=e=>{var{h:t,s,v:r,a:d}=e,n=(200-s)*r/E;return{h:t,s:n>0&&n<200?s*r/E/(n<=E?n:200-n)*E:0,l:n/2,a:d}},ke=e=>{var{r:t,g:s,b:r}=e,d=t<<16|s<<8|r;return"#"+(n=>new Array(7-n.length).join("0")+n)(d.toString(16))},Xe=e=>{var{r:t,g:s,b:r,a:d}=e,n=typeof d=="number"&&(d*255|256).toString(16).slice(1);return""+ke({r:t,g:s,b:r})+(n||"")},U=e=>$(Ye(e)),Ye=e=>{var t=e.replace("#","");/^#?/.test(e)&&t.length===3&&(e="#"+t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2));var s=new RegExp("[A-Za-z0-9]{2}","g"),[r,d,n=0,l]=e.match(s).map(c=>parseInt(c,16));return{r,g:d,b:n,a:(l??255)/D}},H=e=>{var{h:t,s,v:r,a:d}=e,n=t/60,l=s/E,c=r/E,h=Math.floor(n)%6,o=n-Math.floor(n),f=D*c*(1-l),m=D*c*(1-l*o),g=D*c*(1-l*(1-o));c*=D;var p={};switch(h){case 0:p.r=c,p.g=g,p.b=f;break;case 1:p.r=m,p.g=c,p.b=f;break;case 2:p.r=f,p.g=c,p.b=g;break;case 3:p.r=f,p.g=m,p.b=c;break;case 4:p.r=g,p.g=f,p.b=c;break;case 5:p.r=c,p.g=f,p.b=m;break}return p.r=Math.round(p.r),p.g=Math.round(p.g),p.b=Math.round(p.b),v({},p,{a:d})},We=e=>{var{r:t,g:s,b:r,a:d}=H(e);return"rgba("+t+", "+s+", "+r+", "+d+")"},Ke=e=>{var{r:t,g:s,b:r}=e;return{r:t,g:s,b:r}},Je=e=>{var{h:t,s,l:r}=e;return{h:t,s,l:r}},Y=e=>ke(H(e)),Qe=e=>{var{h:t,s,v:r}=e;return{h:t,s,v:r}},Ze=e=>{var{r:t,g:s,b:r}=e,d=function(f){return f<=.04045?f/12.92:Math.pow((f+.055)/1.055,2.4)},n=d(t/255),l=d(s/255),c=d(r/255),h={};return h.x=n*.4124+l*.3576+c*.1805,h.y=n*.2126+l*.7152+c*.0722,h.bri=n*.0193+l*.1192+c*.9505,h},I=e=>{var t,s,r,d,n,l,c,h,o;return typeof e=="string"&&W(e)?(l=U(e),h=e):typeof e!="string"&&(l=e),l&&(r=Qe(l),n=Se(l),d=H(l),o=Xe(d),h=Y(l),s=Je(n),t=Ke(d),c=Ze(t)),{rgb:t,hsl:s,hsv:r,rgba:d,hsla:n,hsva:l,hex:h,hexa:o,xy:c}},W=e=>/^#?([A-Fa-f0-9]{3,4}){1,2}$/.test(e);function ge(e){var t=N.useRef(e);return N.useEffect(()=>{t.current=e}),N.useCallback((s,r)=>t.current&&t.current(s,r),[])}var L=e=>"touches"in e,ve=e=>{!L(e)&&e.preventDefault&&e.preventDefault()},z=function(t,s,r){return s===void 0&&(s=0),r===void 0&&(r=1),t>r?r:t<s?s:t},xe=(e,t)=>{var s=e.getBoundingClientRect(),r=L(t)?t.touches[0]:t;return{left:z((r.pageX-(s.left+window.pageXOffset))/s.width),top:z((r.pageY-(s.top+window.pageYOffset))/s.height),width:s.width,height:s.height,x:r.pageX-(s.left+window.pageXOffset),y:r.pageY-(s.top+window.pageYOffset)}},ea=["prefixCls","className","onMove","onDown"],J=A.forwardRef((e,t)=>{var{prefixCls:s="w-color-interactive",className:r,onMove:d,onDown:n}=e,l=P(e,ea),c=N.useRef(null),h=N.useRef(!1),[o,f]=N.useState(!1),m=ge(d),g=ge(n),p=x=>h.current&&!L(x)?!1:(h.current=L(x),!0),b=N.useCallback(x=>{if(ve(x),!!c.current){var w=L(x)?x.touches.length>0:x.buttons>0;if(!w){f(!1);return}m==null||m(xe(c.current,x),x)}},[m]),y=N.useCallback(()=>f(!1),[]),u=N.useCallback(x=>{x?(window.addEventListener(h.current?"touchmove":"mousemove",b),window.addEventListener(h.current?"touchend":"mouseup",y)):(window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",y),window.removeEventListener("touchmove",b),window.removeEventListener("touchend",y))},[b,y]);N.useEffect(()=>(u(o),()=>{u(!1)}),[o,b,y,u]);var i=N.useCallback(x=>{ve(x.nativeEvent),p(x.nativeEvent)&&c.current&&(g==null||g(xe(c.current,x.nativeEvent),x.nativeEvent),f(!0))},[g]);return a.jsx("div",v({},l,{className:[s,r||""].filter(Boolean).join(" "),style:v({},l.style,{touchAction:"none"}),ref:c,tabIndex:0,onMouseDown:i,onTouchStart:i}))});J.displayName="Interactive";var aa=e=>{var{className:t,color:s,left:r,top:d,prefixCls:n}=e,l={position:"absolute",top:d,left:r},c={"--saturation-pointer-box-shadow":"rgb(255 255 255) 0px 0px 0px 1.5px, rgb(0 0 0 / 30%) 0px 0px 1px 1px inset, rgb(0 0 0 / 40%) 0px 0px 1px 2px",width:6,height:6,transform:"translate(-3px, -3px)",boxShadow:"var(--saturation-pointer-box-shadow)",borderRadius:"50%",backgroundColor:s};return N.useMemo(()=>a.jsx("div",{className:n+"-pointer "+(t||""),style:l,children:a.jsx("div",{className:n+"-fill",style:c})}),[d,r,s,t,n])},ra=["prefixCls","radius","pointer","className","hue","style","hsva","onChange"],Ae=A.forwardRef((e,t)=>{var s,{prefixCls:r="w-color-saturation",radius:d=0,pointer:n,className:l,hue:c=0,style:h,hsva:o,onChange:f}=e,m=P(e,ra),g=v({width:200,height:200,borderRadius:d},h,{position:"relative"}),[p,b]=N.useState({left:0,top:0,x:0,y:0,width:0,height:0}),y=(i,x)=>{b(i),f&&o&&f({h:o.h,s:i.left*100,v:(1-i.top)*100,a:o.a})},u=N.useMemo(()=>{if(!o)return null;var i=z(p.x,0,p.width)+"px",x=z(p.y,0,p.height)+"px";(p.width===0||p.height===0)&&(i=o.s+"%",x=100-o.v+"%");var w={top:x,left:i,color:Ce(o)};return n&&typeof n=="function"?n(v({prefixCls:r},w)):a.jsx(aa,v({prefixCls:r},w))},[o,p,n,r]);return a.jsx(J,v({className:[r,l||""].filter(Boolean).join(" ")},m,{style:v({position:"absolute",inset:0,cursor:"crosshair",backgroundImage:"linear-gradient(0deg, #000, transparent), linear-gradient(90deg, #fff, hsl("+((s=o==null?void 0:o.h)!=null?s:c)+", 100%, 50%))"},g),ref:t,onMove:y,onDown:y,children:u}))});Ae.displayName="Saturation";var ta=["className","prefixCls","left","top","style","fillProps"],sa=e=>{var{className:t,prefixCls:s,left:r,top:d,style:n,fillProps:l}=e,c=P(e,ta),h=v({},n,{position:"absolute",left:r,top:d}),o=v({width:18,height:18,boxShadow:"var(--alpha-pointer-box-shadow)",borderRadius:"50%",backgroundColor:"var(--alpha-pointer-background-color)"},l==null?void 0:l.style,{transform:r?"translate(-9px, -1px)":"translate(-1px, -9px)"});return a.jsx("div",v({className:s+"-pointer "+(t||""),style:h},c,{children:a.jsx("div",v({className:s+"-fill"},l,{style:o}))}))},la=["prefixCls","className","hsva","background","bgProps","innerProps","pointerProps","radius","width","height","direction","style","onChange","pointer"],oa="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==",O=A.forwardRef((e,t)=>{var{prefixCls:s="w-color-alpha",className:r,hsva:d,background:n,bgProps:l={},innerProps:c={},pointerProps:h={},radius:o=0,width:f,height:m=16,direction:g="horizontal",style:p,onChange:b,pointer:y}=e,u=P(e,la),i=k=>{b&&b(v({},d,{a:g==="horizontal"?k.left:k.top}),k)},x=Ce(Object.assign({},d,{a:1})),w="linear-gradient(to "+(g==="horizontal"?"right":"bottom")+", rgba(244, 67, 54, 0) 0%, "+x+" 100%)",C={};g==="horizontal"?C.left=d.a*100+"%":C.top=d.a*100+"%";var S=v({"--alpha-background-color":"#fff","--alpha-pointer-background-color":"rgb(248, 248, 248)","--alpha-pointer-box-shadow":"rgb(0 0 0 / 37%) 0px 1px 4px 0px",borderRadius:o,background:"url("+oa+") left center",backgroundColor:"var(--alpha-background-color)"},{width:f,height:m},p,{position:"relative"}),j=y&&typeof y=="function"?y(v({prefixCls:s},h,C)):a.jsx(sa,v({},h,{prefixCls:s},C));return a.jsxs("div",v({},u,{className:[s,s+"-"+g,r||""].filter(Boolean).join(" "),style:S,ref:t,children:[a.jsx("div",v({},l,{style:v({inset:0,position:"absolute",background:n||w,borderRadius:o},l.style)})),a.jsx(J,v({},c,{style:v({},c.style,{inset:0,zIndex:1,position:"absolute"}),onMove:i,onDown:i,children:j}))]}))});O.displayName="Alpha";var ia=["prefixCls","placement","label","value","className","style","labelStyle","inputStyle","onChange","onBlur","renderInput"],na=e=>/^#?([A-Fa-f0-9]{3,4}){1,2}$/.test(e),da=e=>Number(String(e).replace(/%/g,"")),T=A.forwardRef((e,t)=>{var{prefixCls:s="w-color-editable-input",placement:r="bottom",label:d,value:n,className:l,style:c,labelStyle:h,inputStyle:o,onChange:f,onBlur:m,renderInput:g}=e,p=P(e,ia),[b,y]=N.useState(n),u=N.useRef(!1);N.useEffect(()=>{e.value!==b&&(u.current||y(e.value))},[e.value]);function i(k,_){var B=(_||k.target.value).trim().replace(/^#/,"");na(B)&&f&&f(k,B);var F=da(B);isNaN(F)||f&&f(k,F),y(B)}function x(k){u.current=!1,y(e.value),m&&m(k)}var w={};r==="bottom"&&(w.flexDirection="column"),r==="top"&&(w.flexDirection="column-reverse"),r==="left"&&(w.flexDirection="row-reverse");var C=v({"--editable-input-label-color":"rgb(153, 153, 153)","--editable-input-box-shadow":"rgb(204 204 204) 0px 0px 0px 1px inset","--editable-input-color":"#666",position:"relative",alignItems:"center",display:"flex",fontSize:11},w,c),S=v({width:"100%",paddingTop:2,paddingBottom:2,paddingLeft:3,paddingRight:3,fontSize:11,background:"transparent",boxSizing:"border-box",border:"none",color:"var(--editable-input-color)",boxShadow:"var(--editable-input-box-shadow)"},o),j=v({value:b,onChange:i,onBlur:x,autoComplete:"off",onFocus:()=>u.current=!0},p,{style:S});return a.jsxs("div",{className:[s,l||""].filter(Boolean).join(" "),style:C,children:[g?g(j,t):a.jsx("input",v({ref:t},j)),d&&a.jsx("span",{style:v({color:"var(--editable-input-label-color)",textTransform:"capitalize"},h),children:d})]})});T.displayName="EditableInput";var ca=["prefixCls","hsva","placement","rProps","gProps","bProps","aProps","className","style","onChange"],Re=A.forwardRef((e,t)=>{var{prefixCls:s="w-color-editable-input-rgba",hsva:r,placement:d="bottom",rProps:n={},gProps:l={},bProps:c={},aProps:h={},className:o,style:f,onChange:m}=e,g=P(e,ca),p=r?H(r):{};function b(u){var i=Number(u.target.value);i&&i>255&&(u.target.value="255"),i&&i<0&&(u.target.value="0")}var y=(u,i,x)=>{typeof u=="number"&&(i==="a"&&(u<0&&(u=0),u>100&&(u=100),m&&m(I($(v({},p,{a:u/100}))))),u>255&&(u=255,x.target.value="255"),u<0&&(u=0,x.target.value="0"),i==="r"&&m&&m(I($(v({},p,{r:u})))),i==="g"&&m&&m(I($(v({},p,{g:u})))),i==="b"&&m&&m(I($(v({},p,{b:u})))))};return a.jsxs("div",v({ref:t,className:[s,o||""].filter(Boolean).join(" ")},g,{style:v({fontSize:11,display:"flex"},f),children:[a.jsx(T,v({label:"R",value:p.r||0,onBlur:b,placement:d,onChange:(u,i)=>y(i,"r",u)},n,{style:v({},n.style)})),a.jsx(T,v({label:"G",value:p.g||0,onBlur:b,placement:d,onChange:(u,i)=>y(i,"g",u)},l,{style:v({marginLeft:5},n.style)})),a.jsx(T,v({label:"B",value:p.b||0,onBlur:b,placement:d,onChange:(u,i)=>y(i,"b",u)},c,{style:v({marginLeft:5},c.style)})),h&&a.jsx(T,v({label:"A",value:p.a?parseInt(String(p.a*100),10):0,onBlur:b,placement:d,onChange:(u,i)=>y(i,"a",u)},h,{style:v({marginLeft:5},h.style)}))]}))});Re.displayName="EditableInputRGBA";var pa=["prefixCls","className","hue","onChange","direction"],Pe=A.forwardRef((e,t)=>{var{prefixCls:s="w-color-hue",className:r,hue:d=0,onChange:n,direction:l="horizontal"}=e,c=P(e,pa);return a.jsx(O,v({ref:t,className:s+" "+(r||"")},c,{direction:l,background:"linear-gradient(to "+(l==="horizontal"?"right":"bottom")+", rgb(255, 0, 0) 0%, rgb(255, 255, 0) 17%, rgb(0, 255, 0) 33%, rgb(0, 255, 255) 50%, rgb(0, 0, 255) 67%, rgb(255, 0, 255) 83%, rgb(255, 0, 0) 100%)",hsva:{h:d,s:100,v:100,a:d/360},onChange:(h,o)=>{n&&n({h:l==="horizontal"?360*o.left:360*o.top})}}))});Pe.displayName="Hue";var ma=["prefixCls","className","color","colors","style","rectProps","onChange","addonAfter","addonBefore","rectRender"],Ee=A.forwardRef((e,t)=>{var{prefixCls:s="w-color-swatch",className:r,color:d,colors:n=[],style:l,rectProps:c={},onChange:h,addonAfter:o,addonBefore:f,rectRender:m}=e,g=P(e,ma),p=v({"--swatch-background-color":"rgb(144, 19, 254)",background:"var(--swatch-background-color)",height:15,width:15,marginRight:5,marginBottom:5,cursor:"pointer",position:"relative",outline:"none",borderRadius:2},c.style),b=(y,u)=>{h&&h(U(y),I(U(y)),u)};return a.jsxs("div",v({ref:t},g,{className:[s,r||""].filter(Boolean).join(" "),style:v({display:"flex",flexWrap:"wrap",position:"relative"},l),children:[f&&A.isValidElement(f)&&f,n&&Array.isArray(n)&&n.map((y,u)=>{var i="",x="";typeof y=="string"&&(i=y,x=y),typeof y=="object"&&y.color&&(i=y.title||y.color,x=y.color);var w=d&&d.toLocaleLowerCase()===x.toLocaleLowerCase(),C=m&&m({title:i,color:x,checked:!!w,style:v({},p,{background:x}),onClick:j=>b(x,j)});if(C)return a.jsx(N.Fragment,{children:C},u);var S=c.children&&A.isValidElement(c.children)?A.cloneElement(c.children,{color:x,checked:w}):null;return a.jsx("div",v({tabIndex:0,title:i,onClick:j=>b(x,j)},c,{children:S,style:v({},p,{background:x})}),u)}),o&&A.isValidElement(o)&&o]}))});Ee.displayName="Swatch";var ua=["prefixCls","className","onChange","width","presetColors","color","editableDisable","disableAlpha","style"],ha=["#D0021B","#F5A623","#f8e61b","#8B572A","#7ED321","#417505","#BD10E0","#9013FE","#4A90E2","#50E3C2","#B8E986","#000000","#4A4A4A","#9B9B9B","#FFFFFF"],ye=e=>a.jsx("div",{style:{boxShadow:"rgb(0 0 0 / 60%) 0px 0px 2px",width:4,top:1,bottom:1,left:e.left,borderRadius:1,position:"absolute",backgroundColor:"#fff"}}),_e=A.forwardRef((e,t)=>{var{prefixCls:s="w-color-sketch",className:r,onChange:d,width:n=218,presetColors:l=ha,color:c,editableDisable:h=!0,disableAlpha:o=!1,style:f}=e,m=P(e,ua),[g,p]=N.useState({h:209,s:36,v:90,a:1});N.useEffect(()=>{typeof c=="string"&&W(c)&&p(U(c)),typeof c=="object"&&p(c)},[c]);var b=j=>{p(j),d&&d(I(j))},y=(j,k)=>{typeof j=="string"&&W(j)&&/(3|6)/.test(String(j.length))&&b(U(j))},u=j=>b(v({},g,{a:j.a})),i=j=>b(v({},g,j,{a:g.a})),x=v({"--sketch-background":"rgb(255, 255, 255)","--sketch-box-shadow":"rgb(0 0 0 / 15%) 0px 0px 0px 1px, rgb(0 0 0 / 15%) 0px 8px 16px","--sketch-swatch-box-shadow":"rgb(0 0 0 / 15%) 0px 0px 0px 1px inset","--sketch-alpha-box-shadow":"rgb(0 0 0 / 15%) 0px 0px 0px 1px inset, rgb(0 0 0 / 25%) 0px 0px 4px inset","--sketch-swatch-border-top":"1px solid rgb(238, 238, 238)",background:"var(--sketch-background)",borderRadius:4,boxShadow:"var(--sketch-box-shadow)",width:n},f),w={borderRadius:2,background:We(g),boxShadow:"var(--sketch-alpha-box-shadow)"},C={borderTop:"var(--sketch-swatch-border-top)",paddingTop:10,paddingLeft:10},S={marginRight:10,marginBottom:10,borderRadius:3,boxShadow:"var(--sketch-swatch-box-shadow)"};return a.jsxs("div",v({},m,{className:s+" "+(r||""),ref:t,style:x,children:[a.jsxs("div",{style:{padding:"10px 10px 8px"},children:[a.jsx(Ae,{hsva:g,style:{width:"auto",height:150},onChange:i}),a.jsxs("div",{style:{display:"flex",marginTop:4},children:[a.jsxs("div",{style:{flex:1},children:[a.jsx(Pe,{width:"auto",height:10,hue:g.h,pointer:ye,innerProps:{style:{marginLeft:1,marginRight:5}},onChange:j=>b(v({},g,j))}),!o&&a.jsx(O,{width:"auto",height:10,hsva:g,pointer:ye,style:{marginTop:4},innerProps:{style:{marginLeft:1,marginRight:5}},onChange:u})]}),!o&&a.jsx(O,{width:24,height:24,hsva:g,radius:2,style:{marginLeft:4},bgProps:{style:{background:"transparent"}},innerProps:{style:w},pointer:()=>a.jsx(N.Fragment,{})})]})]}),h&&a.jsxs("div",{style:{display:"flex",margin:"0 10px 3px 10px"},children:[a.jsx(T,{label:"Hex",value:Y(g).replace(/^#/,"").toLocaleUpperCase(),onChange:(j,k)=>y(k),style:{minWidth:58}}),a.jsx(Re,{hsva:g,style:{marginLeft:6},aProps:o?!1:{},onChange:j=>b(j.hsva)})]}),l&&l.length>0&&a.jsx(Ee,{style:C,colors:l,color:Y(g),onChange:j=>b(j),rectProps:{style:S}})]}))});_e.displayName="Sketch";function be({value:e,onChange:t,onBlur:s}){const r=N.useCallback(d=>{t==null||t(d.hex)},[t]);return a.jsx(_e,{disableAlpha:!0,onChange:r,onBlur:s,color:e})}const je=(e,t,s)=>{if(e&&"reportValidity"in e){const r=X(s,t);e.setCustomValidity(r&&r.message||""),e.reportValidity()}},Be=(e,t)=>{for(const s in t.fields){const r=t.fields[s];r&&r.ref&&"reportValidity"in r.ref?je(r.ref,s,e):r&&r.refs&&r.refs.forEach(d=>je(d,s,e))}},fa=(e,t)=>{t.shouldUseNativeValidation&&Be(e,t);const s={};for(const r in e){const d=X(t.fields,r),n=Object.assign(e[r]||{},{ref:d&&d.ref});if(ga(t.names||Object.keys(e),r)){const l=Object.assign({},X(s,r));M(l,"root",n),M(s,r,l)}else M(s,r,n)}return s},ga=(e,t)=>{const s=Ne(t);return e.some(r=>Ne(r).match(`^${s}\\.\\d+`))};function Ne(e){return e.replace(/\]|\[/g,"")}function va(e,t){for(var s={};e.length;){var r=e[0],d=r.code,n=r.message,l=r.path.join(".");if(!s[l])if("unionErrors"in r){var c=r.unionErrors[0].errors[0];s[l]={message:c.message,type:c.code}}else s[l]={message:n,type:d};if("unionErrors"in r&&r.unionErrors.forEach(function(f){return f.errors.forEach(function(m){return e.push(m)})}),t){var h=s[l].types,o=h&&h[r.code];s[l]=De(l,t,s,d,o?[].concat(o,r.message):r.message)}e.shift()}return s}function xa(e,t,s){return s===void 0&&(s={}),function(r,d,n){try{return Promise.resolve(function(l,c){try{var h=Promise.resolve(e[s.mode==="sync"?"parse":"parseAsync"](r,t)).then(function(o){return n.shouldUseNativeValidation&&Be({},n),{errors:{},values:s.raw?Object.assign({},r):o}})}catch(o){return c(o)}return h&&h.then?h.then(void 0,c):h}(0,function(l){if(function(c){return Array.isArray(c==null?void 0:c.errors)}(l))return{values:{},errors:fa(va(l.errors,!n.shouldUseNativeValidation&&n.criteriaMode==="all"),n)};throw l}))}catch(l){return Promise.reject(l)}}}async function ya(){const e=await fetch("/jsons/rulesets/index.json");if(!e.ok)throw new Error(`Response status: ${e.status}`);return await e.json()}async function ba(e){const t=await fetch(`/jsons/rulesets/entries/${e}.json`);if(!t.ok)throw new Error(`Response status: ${t.status}`);return await t.json()}function ja(){return K({queryKey:["v2-rulesets"],queryFn:ya,placeholderData:we})}function Na(e){return K({queryKey:["v2-rulesets",e],queryFn:({queryKey:t})=>ba(t[1]),enabled:!!e,initialData:void 0,placeholderData:we})}function wa({score:e,scoreChanges:t=[],point:s,ranking:r,isEast:d,isRiichi:n,isYellowCarded:l,isRedCarded:c,isRonDisallowed:h,waitingTiles:o,showPointAndRanking:f,className:m,player:g,...p}){var w,C;const[b,y]=N.useState(e),[u,i]=N.useState(null),x=N.useMemo(()=>!!u,[u]);return N.useEffect(()=>{e!==b&&(i(t),setTimeout(()=>{y(e)},2550),setTimeout(()=>{i(null)},3e3))},[e,t,b]),a.jsxs("div",{className:"relative min-w-[5.35em] mx-auto [&_.hide-if-changing]:transition-opacity data-[score-changing='1']:[&_.hide-if-changing]:opacity-0 overflow-visible","data-score-changing":x?"1":"0",children:[a.jsxs("div",{className:"absolute top-[0.05em] bottom-[0.15em] -left-[0.1em] -right-[0.1em] rounded-[0.1em] overflow-hidden -z-50",children:[l&&a.jsx("div",{className:"absolute top-0 left-0 w-[200%] aspect-square animate-[yellowPenaltyAni_8s_ease-in-out_1]"}),c&&a.jsx("div",{className:"absolute top-0 left-0 w-[200%] aspect-square animate-[redPenaltyAni_8s_ease-in-out_1]"})]}),l&&a.jsx("div",{className:"absolute -top-[0.4em] left-0 h-[0.5em] w-[0.37em] bg-[#ffe100] rounded-[0.05em]"}),c&&a.jsx("div",{className:"absolute -top-[0.4em] left-[0.45em] h-[0.5em] w-[0.37em] bg-[#ff1900] rounded-[0.05em]"}),a.jsxs("div",{className:"flex items-end gap-x-[0.1em]",children:[a.jsxs("div",{className:"shrink-0 w-[1.75em] h-full relative -bottom-[0.085em] -left-[0.085em]",children:[a.jsx("div",{className:"absolute w-full h-full bg-[#d1b571] overflow-hidden rounded-[0.1em]",style:{opacity:n?1:0},children:a.jsx("div",{className:"origin-bottom w-[200%] h-[100%] bg-[#d1291d] animate-[riichi_8s_ease-in-out_infinite]"})}),a.jsx("div",{className:"relative z-10 w-full aspect-90/125 p-[0.085em]",children:a.jsxs("div",{className:"w-full h-full bg-white rounded-[0.08em] overflow-hidden",style:{background:`linear-gradient(180deg, ${g.color.primary}, ${g.color.secondary})`},children:[((w=g.image.logo)==null?void 0:w.default.url)&&a.jsx("div",{className:"absolute inset-[0.085em] overflow-hidden",children:a.jsx("img",{className:"absolute max-w-[none] h-[2.2em] w-[2.2em] opacity-30 animate-[scrollFromRightToLeft_12s_linear_infinite]",src:g.image.logo.default.url,alt:g.name.display.primary})}),((C=g.image.portrait)==null?void 0:C.default.url)&&a.jsx("img",{className:"relative z-10 w-full h-full rounded-[0.08em]",src:g.image.portrait.default.url,alt:g.name.display.primary}),g.name.display.third&&a.jsx("div",{className:"absolute bottom-[0.085em] left-[0.085em] right-[0.085em] rounded-b-[0.08em] bg-[linear-gradient(to_top,#00000060,#00000050_70%,transparent)] text-white z-20",children:a.jsx("p",{className:"text-center text-[0.25em] font-semibold pb-[0.25em] pt-[0.5em]",children:g.name.display.third})})]})})]}),a.jsxs("div",{className:"flex-1 flex flex-col gap-y-[0.125em] items-start justify-end",children:[a.jsxs("div",{className:"flex gap-[0.125em] relative self-stretch",children:[a.jsx("div",{className:"absolute inset-0 flex items-end",children:a.jsxs("div",{className:"text-center bg-red-600 text-[0.3em] flex gap-x-[0.2em] px-[1em] opacity-0 transition-opacity hide-if-changing cursor-pointer",style:{opacity:h?1:0},children:[a.jsx("i",{className:"bi bi-ban"})," 和了禁止"]})}),a.jsxs("div",{className:"bg-black bg-opacity-60 rounded-sm text-[0.5em] flex gap-x-[0.2em] p-[0.1em] pl-[0.2em] pr-[0.2em] opacity-0 transition-opacity data-[has-waiting-tiles='1']:opacity-100 hide-if-changing cursor-pointer","data-has-waiting-tiles":o&&o.length>0?"1":"0",children:[a.jsx("div",{className:"flex-1 leading-none min-h-[1.19em] flex flex-wrap gap-[0.15em]",children:o==null?void 0:o.map(S=>a.jsx(Ie,{className:"inline-block align-bottom w-[0.85em] animate-[fadeInFromLeft_1s_ease-in-out]",children:S},S))}),a.jsx("div",{className:"bg-[#FFFFFF] w-[4px]"}),a.jsxs("div",{className:"text-[#FFFFFF] text-[0.4em] leading-[1.3em] flex items-center",children:["待",a.jsx("br",{}),"牌"]})]})]}),a.jsxs("div",{className:`relative w-full text-left bg-white px-[0.1em] pb-[0.05em] pt-[0.08em] ${m}`,...p,style:{background:`linear-gradient(260deg, transparent, transparent 22px, ${g.color.secondary} 23px, ${g.color.primary} 100%`,textShadow:"#00000048 2px 2px 3px, #00000048 -2px -2px 3px, #00000048 -2px 2px 3px, #00000048 2px -2px 3px, #00000048 0 0 6px"},children:[a.jsxs("div",{className:"flex flex-col justify-center gap-y-[0.075em] mt-[0.04em]",children:[a.jsx("div",{className:"text-[0.1875em] ml-[0.1em] leading-none text-white hide-if-changing font-semibold whitespace-nowrap",children:g.name.display.secondary||"　"}),a.jsx("div",{className:"text-[0.3125em] ml-[0.1em] leading-none text-white hide-if-changing font-semibold whitespace-nowrap",style:{transformOrigin:"left",transform:(g.name.display.primary||"").length>=17?"scaleX(0.9)":"scaleX(1)"},children:g.name.display.primary})]}),u&&a.jsx("div",{className:"absolute bottom-[2.75em] pr-[0.125em] left-0 text-[0.5625em] leading-none animate-[drop_3s_ease-in-out] font-numeric",children:u.map(S=>a.jsx("div",{children:a.jsx(me,{signed:!0,value:S,positiveClassName:"text-[#09eb09]",negativeClassName:"text-[#eb0000]"})}))}),a.jsxs("div",{className:"relative mt-[0.12em] mb-[0.03em]",children:[a.jsx("p",{className:"relative text-[0.5625em] flex-1 leading-none text-white font-numeric",style:{transition:"opacity 1s, bottom 1s",opacity:f?0:1,bottom:f?"1em":0},children:a.jsx(me,{animated:!0,value:b})}),a.jsxs("p",{className:"absolute left-0 right-[0.25em] text-[0.5625em] flex-1 leading-none text-white font-numeric",style:{transition:"opacity 1s, bottom 1s",opacity:f?1:0,bottom:f?0:"-1em"},children:[Te(s),a.jsx("span",{className:"text-[0.8em]",children:"pt"}),a.jsx("span",{className:"absolute right-0 bottom-0 text-[0.75em]",children:Fe(r)})]})]})]})]})]}),a.jsx("div",{className:`mt-[0.2em] h-[0.075em] rounded-full ${d&&"bg-red-500"}`})]})}const Ca=["東家","南家","西家","北家"],Sa=fe({name:R({required_error:"必須填寫對局名稱。"}),rulesetId:R({required_error:"必須選擇其中一套規則。"}),players:qe(fe({namePrimary:R({required_error:"玩家必須有名稱"}),nameSecondary:R(),nameThird:R(),colorPrimary:R({required_error:"玩家必須有主要顏色"}).regex(/^#[0-9A-F]{6}$/i,"顏色必須是 #ABCDEF 格式。"),colorSecondary:R({required_error:"玩家必須有次要顏色"}).regex(/^#[0-9A-F]{6}$/i,"顏色必須是 #ABCDEF 格式。"),imagePortraitUrl:R().url("玩家圖片必須是URL。").optional(),imageLogoUrl:R().url("隊伍圖片／立直圖片必須是URL。").optional()}))});function ka({onSubmit:e,defaultValues:t,autoSubmit:s}){var y;const{data:r=[]}=ja(),{control:d,register:n,handleSubmit:l,reset:c,formState:h}=$e({resolver:xa(Sa),defaultValues:t}),o=ue({name:"rulesetId",control:d}),{data:f}=Na(o),m=ue({name:"players",control:d}),g=N.useCallback(u=>{if(!f)return;const i=parseInt(u.currentTarget.getAttribute("data-player-index"));if(typeof i!="number")return;const x=(i+1+f.data.playerCount)%f.data.playerCount;c(w=>{const C=[...w.players];return[C[i],C[x]]=[C[x],C[i]],{...w,players:C}})},[c,f]),p=N.useMemo(()=>l(u=>{e({schemaVersion:"v20250403",code:Le(),data:{name:u.name,remark:"",players:u.players.map(i=>({id:"",name:{display:{primary:i.namePrimary,secondary:i.nameSecondary,third:i.nameThird},official:{primary:i.namePrimary,secondary:i.nameSecondary,third:i.nameThird}},color:{primary:i.colorPrimary,secondary:i.colorSecondary},image:{portrait:i.imagePortraitUrl?{default:{url:i.imagePortraitUrl}}:void 0}})),rulesetRef:u.rulesetId},metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}})}),[l,e]),b=N.useCallback(()=>{c(t)},[t,c]);return N.useEffect(()=>{t&&c(t)},[t,c]),N.useEffect(()=>{s&&p&&p()},[p]),r.length===0?a.jsx("div",{children:"讀取中…"}):a.jsxs("form",{onSubmit:p,children:[a.jsx("input",{type:"text",className:"bg-base-200 input input-xl input-ghost w-full",placeholder:"玩家名稱",...n("name")}),a.jsx("h4",{className:"mt-4",children:"規則"}),a.jsxs("fieldset",{className:"fieldset",children:[a.jsx("select",{className:"select",...n("rulesetId"),children:r.map(u=>a.jsx("option",{value:u.id,children:u.metadata.name.display}))}),a.jsx("p",{className:"fieldset-label text-error",children:(y=h.errors.rulesetId)==null?void 0:y.message})]}),a.jsx("div",{className:"divider"}),a.jsx("h4",{children:"玩家"}),a.jsx("div",{className:"flex gap-x-4",children:new Array(f==null?void 0:f.data.playerCount).fill(void 0).map((u,i)=>{var x,w,C,S,j,k,_,B,F,Q,Z,ee,ae,re,te,se,le,oe,ie,ne,de,ce,pe;return a.jsx("div",{className:"flex-1",children:a.jsxs("fieldset",{className:"relative fieldset border-2 border-base-300 p-4 rounded-box",style:{borderColor:(x=m==null?void 0:m[i])==null?void 0:x.colorPrimary,backgroundColor:`${(w=m==null?void 0:m[i])==null?void 0:w.colorPrimary}20`},children:[a.jsx("legend",{className:"fieldset-legend",children:Ca[i]}),a.jsx("label",{className:"fieldset-label",children:"名稱"}),a.jsx("input",{type:"text",className:"input",placeholder:"玩家名稱",...n(`players.${i}.namePrimary`)}),a.jsx("p",{className:"fieldset-label text-error",children:(j=(S=(C=h.errors.players)==null?void 0:C[i])==null?void 0:S.namePrimary)==null?void 0:j.message}),a.jsx("label",{className:"fieldset-label",children:"稱號"}),a.jsx("input",{type:"text",className:"input",placeholder:"玩家名稱",...n(`players.${i}.nameSecondary`)}),a.jsx("p",{className:"fieldset-label text-error",children:(B=(_=(k=h.errors.players)==null?void 0:k[i])==null?void 0:_.nameSecondary)==null?void 0:B.message}),a.jsx("label",{className:"fieldset-label",children:"暱稱"}),a.jsx("input",{type:"text",className:"input",placeholder:"玩家名稱",...n(`players.${i}.nameThird`)}),a.jsx("p",{className:"fieldset-label text-error",children:(Z=(Q=(F=h.errors.players)==null?void 0:F[i])==null?void 0:Q.nameThird)==null?void 0:Z.message}),a.jsx("label",{className:"fieldset-label",children:"顏色"}),a.jsx(he,{control:d,name:`players.${i}.colorPrimary`,render:({field:{onChange:V,onBlur:q,value:G}})=>a.jsx(be,{onChange:V,onBlur:q,value:G})}),a.jsx("p",{className:"fieldset-label text-error",children:(re=(ae=(ee=h.errors.players)==null?void 0:ee[i])==null?void 0:ae.colorPrimary)==null?void 0:re.message}),a.jsx("label",{className:"fieldset-label",children:"次顏色"}),a.jsx(he,{control:d,name:`players.${i}.colorSecondary`,render:({field:{onChange:V,onBlur:q,value:G}})=>a.jsx(be,{onChange:V,onBlur:q,value:G})}),a.jsx("p",{className:"fieldset-label text-error",children:(le=(se=(te=h.errors.players)==null?void 0:te[i])==null?void 0:se.colorSecondary)==null?void 0:le.message}),a.jsx("label",{className:"fieldset-label",children:"圖片"}),a.jsx("input",{type:"text",className:"input w-full",placeholder:"https://....png",...n(`players.${i}.imagePortraitUrl`)}),a.jsx("p",{className:"fieldset-label text-error",children:(ne=(ie=(oe=h.errors.players)==null?void 0:oe[i])==null?void 0:ie.imagePortraitUrl)==null?void 0:ne.message}),a.jsx("label",{className:"fieldset-label",children:"隊伍圖片／立直圖片"}),a.jsx("input",{type:"text",className:"input w-full",placeholder:"https://....png",...n(`players.${i}.imageLogoUrl`)}),a.jsx("p",{className:"fieldset-label text-error",children:(pe=(ce=(de=h.errors.players)==null?void 0:de[i])==null?void 0:ce.imageLogoUrl)==null?void 0:pe.message}),a.jsx("div",{className:"divider"}),a.jsx("label",{className:"fieldset-label",children:"預覽"}),(m==null?void 0:m[i])&&a.jsxs("div",{children:[a.jsx("div",{className:"w-full text-[48px]",children:a.jsx(wa,{score:(f==null?void 0:f.data.startingPoint)??0,player:{id:"",name:{official:{primary:m[i].namePrimary,secondary:m[i].nameSecondary,third:m[i].nameThird},display:{primary:m[i].namePrimary,secondary:m[i].nameSecondary,third:m[i].nameThird}},color:{primary:m[i].colorPrimary,secondary:m[i].colorSecondary},image:{portrait:{default:{url:m[i].imagePortraitUrl}}}}})},i),a.jsx("div",{children:a.jsx("img",{className:"w-full aspect-square",src:m[i].imageLogoUrl,alt:""})})]}),a.jsx("button",{type:"button",className:"z-10 absolute btn rounded-full -right-8 -top-4 shadow",onClick:g,"data-player-index":i,children:a.jsx("i",{className:"bi bi-arrow-left-right"})})]})},i)})}),a.jsxs("div",{className:"text-center mt-8 space-x-8",children:[a.jsx("button",{type:"button",onClick:b,className:"btn btn-lg btn-ghost",children:"重置"}),a.jsx("button",{type:"submit",className:"btn btn-primary btn-lg",children:"建立對局"})]})]})}function Ea(){const e=Ue(),{matchId:t}=ze(),[s]=Oe(),[,r]=He(),{data:{tournament:d,playersMap:n}}=Ge(),{data:l}=K({queryKey:["v2-matches",t],queryFn:({queryKey:o})=>Me(o[1])}),c=N.useCallback(async o=>{var p,b,y,u,i,x,w,C,S,j,k,_;if(!l||!confirm("確定資料都正確了嗎？要開始對局了嗎？"))return;const f={code:l.code,name:o.data.name,remark:"",createdAt:new Date().toISOString(),createdBy:"Dicky",updatedAt:new Date().toISOString(),updatedBy:"Dicky",setting:{startingScore:"25000",isManganRoundUp:"1",yakuMax:"12",yakumanMax:"13"},players:{0:{primaryName:o.data.players[0].name.display.primary,secondaryName:o.data.players[0].name.display.secondary??"",nickname:o.data.players[0].name.display.third??"",color:o.data.players[0].color.primary,logoUrl:((p=o.data.players[0].image.logo)==null?void 0:p.default.url)??"",propicUrl:((b=o.data.players[0].image.portrait)==null?void 0:b.default.url)??"",largeLogoUrl:((y=o.data.players[0].image.logo)==null?void 0:y.default.url)??""},1:{primaryName:o.data.players[1].name.display.primary,secondaryName:o.data.players[1].name.display.secondary??"",nickname:o.data.players[1].name.display.third??"",color:o.data.players[1].color.primary,logoUrl:((u=o.data.players[1].image.logo)==null?void 0:u.default.url)??"",propicUrl:((i=o.data.players[1].image.portrait)==null?void 0:i.default.url)??"",largeLogoUrl:((x=o.data.players[1].image.logo)==null?void 0:x.default.url)??""},2:{primaryName:o.data.players[2].name.display.primary,secondaryName:o.data.players[2].name.display.secondary??"",nickname:o.data.players[2].name.display.third??"",color:o.data.players[2].color.primary,logoUrl:((w=o.data.players[2].image.logo)==null?void 0:w.default.url)??"",propicUrl:((C=o.data.players[2].image.portrait)==null?void 0:C.default.url)??"",largeLogoUrl:((S=o.data.players[2].image.logo)==null?void 0:S.default.url)??""},3:{primaryName:o.data.players[3].name.display.primary,secondaryName:o.data.players[3].name.display.secondary??"",nickname:o.data.players[3].name.display.third??"",color:o.data.players[3].color.primary,logoUrl:((j=o.data.players[3].image.logo)==null?void 0:j.default.url)??"",propicUrl:((k=o.data.players[3].image.portrait)==null?void 0:k.default.url)??"",largeLogoUrl:((_=o.data.players[3].image.logo)==null?void 0:_.default.url)??""}},activeResultDetail:null};await e.set(`matches/${l.code}`,f);const m=25e3,g={matchId:l.code,code:Ve(l.code,1,0),roundCount:1,extendedRoundCount:0,cumulatedThousands:0,nextRoundCumulatedThousands:0,resultType:0,nextRoundType:0,playerResults:{0:{beforeScore:m,afterScore:m,type:0,scoreChanges:[],prevScoreChanges:[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}},1:{beforeScore:m,afterScore:m,type:0,scoreChanges:[],prevScoreChanges:[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}},2:{beforeScore:m,afterScore:m,type:0,scoreChanges:[],prevScoreChanges:[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}},3:{beforeScore:m,afterScore:m,type:0,scoreChanges:[],prevScoreChanges:[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}}},doras:[]};await e.push("matchRounds",g),await e.update("obs/1",{matchId:l.code,themeId:(d==null?void 0:d.themeId)??"default"}),r("/obs/match-control")},[e,l,r,d==null?void 0:d.themeId]),h=N.useMemo(()=>{if(l)return{name:l.data.name,rulesetId:l.data.rulesetRef,players:[n[l.data.players[0].id]??l.data.players[0],n[l.data.players[1].id]??l.data.players[1],n[l.data.players[2].id]??l.data.players[2],n[l.data.players[3].id]??l.data.players[3]].map(o=>{var f,m;return{namePrimary:o.name.display.primary,nameSecondary:o.name.display.secondary??"",nameThird:o.name.display.third??"",colorPrimary:o.color.primary,colorSecondary:o.color.secondary??o.color.primary,imagePortraitUrl:(f=o.image.portrait)==null?void 0:f.default.url,imageLogoUrl:(m=o.image.logo)==null?void 0:m.default.url}})}},[l,n]);return l?a.jsx(a.Fragment,{children:a.jsx("section",{className:"container mx-6 my-4",children:a.jsx(ka,{defaultValues:h,onSubmit:c,autoSubmit:!!s.get("autoSubmit")})})}):a.jsx(a.Fragment,{})}export{Ea as default};
