import{r as l,z as I,j as e,c as D,d as C}from"./index-D_zi-PEm.js";import{M as P}from"./index-CN5arYme.js";import{M as S}from"./index-BJmlre6f.js";import{u as E}from"./index-DAMtnkVo.js";import{v as M,e as $,R as y}from"./mahjong.helper-DVgaoY_t.js";import{M as w}from"./index-G2P5mRlY.js";import{M as U}from"./index-sm-QIfR_.js";function R({score:n,scoreChanges:t=[],point:s,ranking:p,isEast:o,isRiichi:r,isYellowCarded:d,isRedCarded:x,isRonDisallowed:g,waitingTiles:c,showPointAndRanking:m,className:a,player:i,playerIndex:f,onClickWaitingTiles:v,...k}){const[j,_]=l.useState(n),[u,N]=l.useState(null),b=l.useMemo(()=>I(i.color??"#000000"),[i.color]),F=l.useMemo(()=>!!u,[u]);return l.useEffect(()=>{n!==j&&(N(t),setTimeout(()=>{_(n)},2550),setTimeout(()=>{N(null)},3e3))},[n,t,j]),e.jsxs("div",{className:"relative min-w-[5.35em] mx-auto [&_.hide-if-changing]:transition-opacity data-[score-changing='1']:[&_.hide-if-changing]:opacity-0 overflow-visible","data-score-changing":F?"1":"0",children:[e.jsxs("div",{className:"absolute top-[0.05em] bottom-[0.15em] -left-[0.1em] -right-[0.1em] rounded-[0.1em] overflow-hidden -z-50",children:[d&&e.jsx("div",{className:"absolute top-0 left-0 w-[200%] aspect-square animate-[yellowPenaltyAni_8s_ease-in-out_1]"}),x&&e.jsx("div",{className:"absolute top-0 left-0 w-[200%] aspect-square animate-[redPenaltyAni_8s_ease-in-out_1]"})]}),d&&e.jsx("div",{className:"absolute -top-[0.4em] left-0 h-[0.5em] w-[0.37em] bg-[#ffe100] rounded-[0.05em]"}),x&&e.jsx("div",{className:"absolute -top-[0.4em] left-[0.45em] h-[0.5em] w-[0.37em] bg-[#ff1900] rounded-[0.05em]"}),e.jsxs("div",{className:"flex items-end gap-x-[0.1em]",children:[e.jsxs("div",{className:"shrink-0 w-[1.75em] h-full relative -bottom-[0.085em] -left-[0.085em]",children:[e.jsx("div",{className:"absolute w-full h-full bg-[#d1b571] overflow-hidden rounded-[0.1em]",style:{opacity:r?1:0},children:e.jsx("div",{className:"origin-bottom w-[200%] h-[100%] bg-[#d1291d] animate-[riichi_8s_ease-in-out_infinite]"})}),e.jsx("div",{className:"relative z-10 w-full aspect-90/125 p-[0.085em]",children:e.jsxs("div",{className:"w-full h-full bg-white rounded-[0.08em] overflow-hidden",style:{background:`linear-gradient(180deg, ${i.color}, ${b})`},children:[i.logoUrl&&e.jsx("div",{className:"absolute inset-[0.085em] overflow-hidden",children:e.jsx("img",{className:"absolute max-w-[none] h-[2.2em] w-[2.2em] opacity-30 animate-[scrollFromRightToLeft_12s_linear_infinite]",src:i.logoUrl,alt:i.primaryName})}),i.propicUrl&&e.jsx("img",{className:"relative z-10 w-full h-full rounded-[0.08em]",src:i.propicUrl,alt:i.primaryName}),i.nickname&&e.jsx("div",{className:"absolute bottom-[0.085em] left-[0.085em] right-[0.085em] rounded-b-[0.08em] bg-[linear-gradient(to_top,#00000060,#00000050_70%,transparent)] text-white z-20",children:e.jsx("p",{className:"text-center text-[0.25em] font-semibold pb-[0.25em] pt-[0.5em]",children:i.nickname})})]})})]}),e.jsxs("div",{className:"flex-1 flex flex-col gap-y-[0.125em] items-start justify-end",children:[e.jsxs("div",{className:"flex gap-[0.125em] relative self-stretch",children:[e.jsx("div",{className:"absolute inset-0 flex items-end",children:e.jsxs("div",{className:"text-center bg-red-600 text-[0.3em] flex gap-x-[0.2em] px-[1em] opacity-0 transition-opacity hide-if-changing cursor-pointer",style:{opacity:g?1:0},children:[e.jsx("i",{className:"bi bi-ban"})," 和了禁止"]})}),e.jsxs("div",{className:"bg-black bg-opacity-60 rounded-sm text-[0.5em] flex gap-x-[0.2em] p-[0.1em] pl-[0.2em] pr-[0.2em] opacity-0 transition-opacity data-[has-waiting-tiles='1']:opacity-100 hide-if-changing cursor-pointer","data-has-waiting-tiles":c&&c.length>0||v?"1":"0",onClick:v,"data-player-index":f,children:[e.jsx("div",{className:"flex-1 leading-none min-h-[1.19em] flex flex-wrap gap-[0.15em]",children:c==null?void 0:c.map(h=>e.jsx(S,{className:"inline-block align-bottom w-[0.85em] animate-[fadeInFromLeft_1s_ease-in-out]",children:h},h))}),e.jsx("div",{className:"bg-[#FFFFFF] w-[4px]"}),e.jsxs("div",{className:"text-[#FFFFFF] text-[0.4em] leading-[1.3em] flex items-center",children:["待",e.jsx("br",{}),"牌"]})]})]}),e.jsxs("div",{className:`relative w-full text-left bg-white px-[0.1em] pb-[0.05em] pt-[0.08em] ${a}`,...k,style:{background:`linear-gradient(260deg, transparent, transparent 22px, ${b} 23px, ${i.color} 100%`,textShadow:"#00000048 2px 2px 3px, #00000048 -2px -2px 3px, #00000048 -2px 2px 3px, #00000048 2px -2px 3px, #00000048 0 0 6px"},children:[e.jsxs("div",{className:"flex flex-col justify-center gap-y-[0.075em] mt-[0.04em]",children:[e.jsx("div",{className:"text-[0.1875em] ml-[0.1em] leading-none text-white hide-if-changing font-semibold whitespace-nowrap",children:i.secondaryName||"　"}),e.jsx("div",{className:"text-[0.3125em] ml-[0.1em] leading-none text-white hide-if-changing font-semibold whitespace-nowrap",style:{transformOrigin:"left",transform:(i.primaryName||"").length>=17?"scaleX(0.9)":"scaleX(1)"},children:i.primaryName})]}),u&&e.jsx("div",{className:"absolute bottom-[2.75em] pr-[0.125em] left-0 text-[0.5625em] leading-none animate-[drop_3s_ease-in-out] font-numeric",children:u.map(h=>e.jsx("div",{children:e.jsx(w,{signed:!0,value:h,positiveClassName:"text-[#09eb09]",negativeClassName:"text-[#eb0000]"})}))}),e.jsxs("div",{className:"relative mt-[0.12em] mb-[0.03em]",children:[e.jsx("p",{className:"relative text-[0.5625em] flex-1 leading-none text-white font-numeric",style:{transition:"opacity 1s, bottom 1s",opacity:m?0:1,bottom:m?"1em":0},children:e.jsx(w,{animated:!0,value:j})}),e.jsxs("p",{className:"absolute left-0 right-[0.25em] text-[0.5625em] flex-1 leading-none text-white font-numeric",style:{transition:"opacity 1s, bottom 1s",opacity:m?1:0,bottom:m?0:"-1em"},children:[D(s),e.jsx("span",{className:"text-[0.8em]",children:"pt"}),e.jsx("span",{className:"absolute right-0 bottom-0 text-[0.75em]",children:C(p)})]})]})]})]})]}),e.jsx("div",{className:`mt-[0.2em] h-[0.075em] rounded-full ${o&&"bg-red-500"}`})]})}const L=({active:n,color:t="#000000",largeLogoUrl:s})=>e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"/images/r.png",className:"w-0 h-0 opacity-0"}),e.jsx("img",{src:"/images/e.png",className:"w-0 h-0 opacity-0"}),e.jsx("img",{src:"/images/a.png",className:"w-0 h-0 opacity-0"}),e.jsx("img",{src:"/images/c.png",className:"w-0 h-0 opacity-0"}),e.jsx("img",{src:"/images/h.png",className:"w-0 h-0 opacity-0"}),e.jsx("img",{src:"/images/score-thousand.png",className:"w-0 h-0 opacity-0"}),n&&e.jsxs("div",{className:"reach-animation",children:[e.jsx("div",{className:"reach-background",style:{background:`linear-gradient(to bottom, transparent, ${t}80 40%, ${t}80 60%, transparent)`}}),e.jsx("div",{className:"reach-animation-logo",style:{backgroundImage:`url("${s}")`}}),e.jsx("div",{className:"reach-animation-bar",style:{backgroundImage:'url("/images/score-thousand.png")'}}),e.jsxs("div",{className:"reach-animation-text",children:[e.jsx("div",{className:"reach-animation-text-character c1",style:{backgroundImage:'url("/images/r.png")'}}),e.jsx("div",{className:"reach-animation-text-character c2",style:{backgroundImage:'url("/images/e.png")'}}),e.jsx("div",{className:"reach-animation-text-character c3",style:{backgroundImage:'url("/images/a.png")'}}),e.jsx("div",{className:"reach-animation-text-character c4",style:{backgroundImage:'url("/images/c.png")'}}),e.jsx("div",{className:"reach-animation-text-character c5",style:{backgroundImage:'url("/images/h.png")'}})]})]})]});function O({params:{matchId:n}}){const{rtMatch:t,rtMatchCurrentRound:s,rtMatchCurrentRoundDoras:p}=E(n),o=l.useMemo(()=>{if(!t||!s)return[];const a=M([s.playerResults[0].afterScore,s.playerResults[1].afterScore,s.playerResults[2].afterScore,s.playerResults[3].afterScore]);return["0","1","2","3"].map((i,f)=>({...t.players[i],color:t.players[i].color,currentStatus:{...s.playerResults[i],isEast:$(i,s.roundCount),...a[f]}}))},[t,s]),[r,d]=l.useState(null),[x,g]=l.useState(),[c,m]=l.useState({0:!1,1:!1,2:!1,3:!1});return l.useEffect(()=>{["0","1","2","3"].forEach(a=>{typeof(s==null?void 0:s.playerResults[a].isRiichi)<"u"&&s.playerResults[a].isRiichi!==c[a]&&(s.playerResults[a].isRiichi===!0&&(d(a),setTimeout(()=>{d(null)},2800)),m(i=>({...i,[a]:s.playerResults[a].isRiichi})))})},[s==null?void 0:s.playerResults,c]),l.useEffect(()=>{x!==(s==null?void 0:s.code)&&(g(s==null?void 0:s.code),m({0:!1,1:!1,2:!1,3:!1}))},[s==null?void 0:s.code,x]),!t||!s?e.jsx("div",{className:"text-current",children:"對局讀取失敗。"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute inset-0 mx-auto py-8 overflow-hidden text-[4.8rem] transition-opacity",style:{background:"linear-gradient(transparent, transparent 73%, rgba(0, 0, 0, 0.4))",opacity:r!==null?0:1},children:[e.jsxs("div",{className:"flex flex-row items-stretch gap-x-4 text-white",children:[e.jsxs("div",{className:"relative text-[0.6em] p-2 pl-10 pr-[1em] flex items-center gap-x-8",style:{transition:"width 0.3s, left 1.5s, opacity 1.5s",left:t.hideHeader?"-100%":"0",opacity:t.hideHeader?"0":"1",background:"linear-gradient(280deg, transparent, transparent 0.5em, #00000080 0.5em, #00000080 100%)"},children:[e.jsxs("div",{className:"",children:[e.jsx("div",{className:"text-[0.5em]",children:t.name}),e.jsxs("div",{className:"flex gap-x-8 items-center",children:[e.jsx("div",{className:"min-w-[3.5em]",children:e.jsx(P,{roundCount:s.roundCount,max:8})}),e.jsxs("div",{className:"flex flex-col justify-around gap-2",children:[e.jsxs("div",{className:"flex-1 flex flex-row items-center gap-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("img",{src:"/images/score-hundred.png",alt:"hundred",className:"h-[0.25em] mt-[0.1em]"})}),e.jsx("div",{className:"text-[0.45em] leading-none",children:s.extendedRoundCount??0})]}),e.jsxs("div",{className:"flex-1 flex flex-row items-center gap-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("img",{src:"/images/score-thousand.png",alt:"thousand",className:"h-[0.25em] mt-[0.1em]"})}),e.jsx("div",{className:"text-[0.45em] leading-none",children:s.cumulatedThousands??0})]})]})]})]}),e.jsx("div",{className:"flex items-center gap-x-2",children:p.map(a=>e.jsx(S,{className:"w-[1.4em]! animate-[fadeInFromLeft_0.5s_ease-in-out]",children:a},a))})]}),e.jsx("div",{className:"flex-1"})]}),e.jsx("div",{className:"flex items-center justify-center mt-20",children:e.jsx("div",{className:"body-hidden mx-20 text-[16px]"})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 px-10 pb-6 grid grid-cols-4 items-end gap-x-8 text-white animate-[fadeInFromBottom_1s_ease-in-out]",style:{opacity:t.activeResultDetail||t.hidePlayers?0:1,bottom:t.activeResultDetail||t.hidePlayers?"-150px":0,transition:"opacity 0.5s, bottom 0.5s"},children:o.map(a=>e.jsxs("div",{className:"w-[5.35em]",children:[e.jsx(R,{player:a,playerIndex:"0",score:a.currentStatus.afterScore,scoreChanges:a.currentStatus.scoreChanges,isEast:a.currentStatus.isEast,isRiichi:a.currentStatus.isRiichi&&s.resultType===y.Unknown,waitingTiles:s.resultType===y.Unknown?a.currentStatus.waitingTiles:[],isYellowCarded:a.currentStatus.isYellowCarded,isRedCarded:a.currentStatus.isRedCarded,isRonDisallowed:a.currentStatus.isRonDisallowed,ranking:a.currentStatus.ranking,point:a.currentStatus.point,showPointAndRanking:!!t.showPoints}),e.jsx("img",{src:a.largeLogoUrl,className:"w-0 h-0"})]},a.primaryName))}),t.activeResultDetail&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 px-10 pb-6 grid grid-cols-4 gap-x-8 text-white transition-opacity animate-[fadeInFromBottom_1s_ease-in-out]",children:[e.jsx("div",{className:"w-[5.35em]",children:e.jsx(R,{player:t.players[t.activeResultDetail.winnerPlayerIndex],playerIndex:"0",score:s.playerResults[t.activeResultDetail.winnerPlayerIndex].afterScore})}),e.jsxs("div",{className:"col-span-3 bg-black/50 py-6 px-8 text-[0.5em] flex items-stretch gap-x-4",children:[e.jsx("div",{className:`flex-1 flex flex-wrap gap-x-[0.75em] ${t.activeResultDetail.yakumanCount>0?"self-center justify-center":""}`,children:t.activeResultDetail.yakus.map(({label:a})=>e.jsx("span",{children:a},a))}),e.jsx("div",{className:"shrink-0 w-px bg-neutral-200"}),e.jsx("div",{className:"shrink-0 min-w-[3em] self-center text-green-400 text-[1.4em] text-center",children:e.jsx(U,{han:t.activeResultDetail.han,fu:t.activeResultDetail.fu,yakumanCount:t.activeResultDetail.yakumanCount})})]})]})]}),e.jsx("div",{className:"absolute top-0 bottom-0 left-0 right-0 pointer-events-none",children:e.jsx(L,{active:r!==null,color:r&&o[r].color,largeLogoUrl:r&&o[r].largeLogoUrl})})]})}export{O as default};
