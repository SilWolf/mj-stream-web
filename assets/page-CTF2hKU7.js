import{r as N,R,j as a,u as Q,k as Ae,c as Le,d as $e,g as Re,o as ge,e as ze,s as A,f as Oe,h as He,i as Ve,l as qe}from"./index-D_zi-PEm.js";import{g as Ge}from"./mahjong.helper-DVgaoY_t.js";import{u as Me}from"./useCurrentTournament-DDGfv-Su.js";import{b as Xe}from"./match.service-CNlLYXqC.js";import{_ as y,g as W,s as Y,a as Ye,u as We,b as ve,C as ye}from"./index.esm-2VRQC1U3.js";import{M as xe}from"./index-G2P5mRlY.js";import{M as Ke}from"./index-BJmlre6f.js";function E(e,t){if(e==null)return{};var s={};for(var r in e)if({}.hasOwnProperty.call(e,r)){if(t.indexOf(r)!==-1)continue;s[r]=e[r]}return s}var U=255,B=100,$=e=>{var{r:t,g:s,b:r,a:n}=e,l=Math.max(t,s,r),c=l-Math.min(t,s,r),d=c?l===t?(s-r)/c:l===s?2+(r-t)/c:4+(t-s)/c:0;return{h:60*(d<0?d+6:d),s:l?c/l*B:0,v:l/U*B,a:n}},Pe=e=>{var{h:t,s,l:r,a:n}=Ee(e);return"hsla("+t+", "+s+"%, "+r+"%, "+n+")"},Ee=e=>{var{h:t,s,v:r,a:n}=e,l=(200-s)*r/B;return{h:t,s:l>0&&l<200?s*r/B/(l<=B?l:200-l)*B:0,l:l/2,a:n}},_e=e=>{var{r:t,g:s,b:r}=e,n=t<<16|s<<8|r;return"#"+(l=>new Array(7-l.length).join("0")+l)(n.toString(16))},Je=e=>{var{r:t,g:s,b:r,a:n}=e,l=typeof n=="number"&&(n*255|256).toString(16).slice(1);return""+_e({r:t,g:s,b:r})+(l||"")},O=e=>$(Qe(e)),Qe=e=>{var t=e.replace("#","");/^#?/.test(e)&&t.length===3&&(e="#"+t.charAt(0)+t.charAt(0)+t.charAt(1)+t.charAt(1)+t.charAt(2)+t.charAt(2));var s=new RegExp("[A-Za-z0-9]{2}","g"),[r,n,l=0,c]=e.match(s).map(d=>parseInt(d,16));return{r,g:n,b:l,a:(c??255)/U}},q=e=>{var{h:t,s,v:r,a:n}=e,l=t/60,c=s/B,d=r/B,i=Math.floor(l)%6,p=l-Math.floor(l),h=U*d*(1-c),u=U*d*(1-c*p),f=U*d*(1-c*(1-p));d*=U;var m={};switch(i){case 0:m.r=d,m.g=f,m.b=h;break;case 1:m.r=u,m.g=d,m.b=h;break;case 2:m.r=h,m.g=d,m.b=f;break;case 3:m.r=h,m.g=u,m.b=d;break;case 4:m.r=f,m.g=h,m.b=d;break;case 5:m.r=d,m.g=h,m.b=u;break}return m.r=Math.round(m.r),m.g=Math.round(m.g),m.b=Math.round(m.b),y({},m,{a:n})},Ze=e=>{var{r:t,g:s,b:r,a:n}=q(e);return"rgba("+t+", "+s+", "+r+", "+n+")"},ea=e=>{var{r:t,g:s,b:r}=e;return{r:t,g:s,b:r}},aa=e=>{var{h:t,s,l:r}=e;return{h:t,s,l:r}},K=e=>_e(q(e)),ra=e=>{var{h:t,s,v:r}=e;return{h:t,s,v:r}},ta=e=>{var{r:t,g:s,b:r}=e,n=function(h){return h<=.04045?h/12.92:Math.pow((h+.055)/1.055,2.4)},l=n(t/255),c=n(s/255),d=n(r/255),i={};return i.x=l*.4124+c*.3576+d*.1805,i.y=l*.2126+c*.7152+d*.0722,i.bri=l*.0193+c*.1192+d*.9505,i},I=e=>{var t,s,r,n,l,c,d,i,p;return typeof e=="string"&&J(e)?(c=O(e),i=e):typeof e!="string"&&(c=e),c&&(r=ra(c),l=Ee(c),n=q(c),p=Je(n),i=K(c),s=aa(l),t=ea(n),d=ta(t)),{rgb:t,hsl:s,hsv:r,rgba:n,hsla:l,hsva:c,hex:i,hexa:p,xy:d}},J=e=>/^#?([A-Fa-f0-9]{3,4}){1,2}$/.test(e);function be(e){var t=N.useRef(e);return N.useEffect(()=>{t.current=e}),N.useCallback((s,r)=>t.current&&t.current(s,r),[])}var z=e=>"touches"in e,je=e=>{!z(e)&&e.preventDefault&&e.preventDefault()},H=function(t,s,r){return s===void 0&&(s=0),r===void 0&&(r=1),t>r?r:t<s?s:t},Ne=(e,t)=>{var s=e.getBoundingClientRect(),r=z(t)?t.touches[0]:t;return{left:H((r.pageX-(s.left+window.pageXOffset))/s.width),top:H((r.pageY-(s.top+window.pageYOffset))/s.height),width:s.width,height:s.height,x:r.pageX-(s.left+window.pageXOffset),y:r.pageY-(s.top+window.pageYOffset)}},sa=["prefixCls","className","onMove","onDown"],Z=R.forwardRef((e,t)=>{var{prefixCls:s="w-color-interactive",className:r,onMove:n,onDown:l}=e,c=E(e,sa),d=N.useRef(null),i=N.useRef(!1),[p,h]=N.useState(!1),u=be(n),f=be(l),m=o=>i.current&&!z(o)?!1:(i.current=z(o),!0),b=N.useCallback(o=>{if(je(o),!!d.current){var w=z(o)?o.touches.length>0:o.buttons>0;if(!w){h(!1);return}u==null||u(Ne(d.current,o),o)}},[u]),x=N.useCallback(()=>h(!1),[]),v=N.useCallback(o=>{o?(window.addEventListener(i.current?"touchmove":"mousemove",b),window.addEventListener(i.current?"touchend":"mouseup",x)):(window.removeEventListener("mousemove",b),window.removeEventListener("mouseup",x),window.removeEventListener("touchmove",b),window.removeEventListener("touchend",x))},[b,x]);N.useEffect(()=>(v(p),()=>{v(!1)}),[p,b,x,v]);var g=N.useCallback(o=>{je(o.nativeEvent),m(o.nativeEvent)&&d.current&&(f==null||f(Ne(d.current,o.nativeEvent),o.nativeEvent),h(!0))},[f]);return a.jsx("div",y({},c,{className:[s,r||""].filter(Boolean).join(" "),style:y({},c.style,{touchAction:"none"}),ref:d,tabIndex:0,onMouseDown:g,onTouchStart:g}))});Z.displayName="Interactive";var la=e=>{var{className:t,color:s,left:r,top:n,prefixCls:l}=e,c={position:"absolute",top:n,left:r},d={"--saturation-pointer-box-shadow":"rgb(255 255 255) 0px 0px 0px 1.5px, rgb(0 0 0 / 30%) 0px 0px 1px 1px inset, rgb(0 0 0 / 40%) 0px 0px 1px 2px",width:6,height:6,transform:"translate(-3px, -3px)",boxShadow:"var(--saturation-pointer-box-shadow)",borderRadius:"50%",backgroundColor:s};return N.useMemo(()=>a.jsx("div",{className:l+"-pointer "+(t||""),style:c,children:a.jsx("div",{className:l+"-fill",style:d})}),[n,r,s,t,l])},oa=["prefixCls","radius","pointer","className","hue","style","hsva","onChange"],Be=R.forwardRef((e,t)=>{var s,{prefixCls:r="w-color-saturation",radius:n=0,pointer:l,className:c,hue:d=0,style:i,hsva:p,onChange:h}=e,u=E(e,oa),f=y({width:200,height:200,borderRadius:n},i,{position:"relative"}),[m,b]=N.useState({left:0,top:0,x:0,y:0,width:0,height:0}),x=(g,o)=>{b(g),h&&p&&h({h:p.h,s:g.left*100,v:(1-g.top)*100,a:p.a})},v=N.useMemo(()=>{if(!p)return null;var g=H(m.x,0,m.width)+"px",o=H(m.y,0,m.height)+"px";(m.width===0||m.height===0)&&(g=p.s+"%",o=100-p.v+"%");var w={top:o,left:g,color:Pe(p)};return l&&typeof l=="function"?l(y({prefixCls:r},w)):a.jsx(la,y({prefixCls:r},w))},[p,m,l,r]);return a.jsx(Z,y({className:[r,c||""].filter(Boolean).join(" ")},u,{style:y({position:"absolute",inset:0,cursor:"crosshair",backgroundImage:"linear-gradient(0deg, #000, transparent), linear-gradient(90deg, #fff, hsl("+((s=p==null?void 0:p.h)!=null?s:d)+", 100%, 50%))"},f),ref:t,onMove:x,onDown:x,children:v}))});Be.displayName="Saturation";var ia=["className","prefixCls","left","top","style","fillProps"],na=e=>{var{className:t,prefixCls:s,left:r,top:n,style:l,fillProps:c}=e,d=E(e,ia),i=y({},l,{position:"absolute",left:r,top:n}),p=y({width:18,height:18,boxShadow:"var(--alpha-pointer-box-shadow)",borderRadius:"50%",backgroundColor:"var(--alpha-pointer-background-color)"},c==null?void 0:c.style,{transform:r?"translate(-9px, -1px)":"translate(-1px, -9px)"});return a.jsx("div",y({className:s+"-pointer "+(t||""),style:i},d,{children:a.jsx("div",y({className:s+"-fill"},c,{style:p}))}))},da=["prefixCls","className","hsva","background","bgProps","innerProps","pointerProps","radius","width","height","direction","style","onChange","pointer"],ca="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAMUlEQVQ4T2NkYGAQYcAP3uCTZhw1gGGYhAGBZIA/nYDCgBDAm9BGDWAAJyRCgLaBCAAgXwixzAS0pgAAAABJRU5ErkJggg==",V=R.forwardRef((e,t)=>{var{prefixCls:s="w-color-alpha",className:r,hsva:n,background:l,bgProps:c={},innerProps:d={},pointerProps:i={},radius:p=0,width:h,height:u=16,direction:f="horizontal",style:m,onChange:b,pointer:x}=e,v=E(e,da),g=k=>{b&&b(y({},n,{a:f==="horizontal"?k.left:k.top}),k)},o=Pe(Object.assign({},n,{a:1})),w="linear-gradient(to "+(f==="horizontal"?"right":"bottom")+", rgba(244, 67, 54, 0) 0%, "+o+" 100%)",S={};f==="horizontal"?S.left=n.a*100+"%":S.top=n.a*100+"%";var C=y({"--alpha-background-color":"#fff","--alpha-pointer-background-color":"rgb(248, 248, 248)","--alpha-pointer-box-shadow":"rgb(0 0 0 / 37%) 0px 1px 4px 0px",borderRadius:p,background:"url("+ca+") left center",backgroundColor:"var(--alpha-background-color)"},{width:h,height:u},m,{position:"relative"}),j=x&&typeof x=="function"?x(y({prefixCls:s},i,S)):a.jsx(na,y({},i,{prefixCls:s},S));return a.jsxs("div",y({},v,{className:[s,s+"-"+f,r||""].filter(Boolean).join(" "),style:C,ref:t,children:[a.jsx("div",y({},c,{style:y({inset:0,position:"absolute",background:l||w,borderRadius:p},c.style)})),a.jsx(Z,y({},d,{style:y({},d.style,{inset:0,zIndex:1,position:"absolute"}),onMove:g,onDown:g,children:j}))]}))});V.displayName="Alpha";var ma=["prefixCls","placement","label","value","className","style","labelStyle","inputStyle","onChange","onBlur","renderInput"],pa=e=>/^#?([A-Fa-f0-9]{3,4}){1,2}$/.test(e),ua=e=>Number(String(e).replace(/%/g,"")),T=R.forwardRef((e,t)=>{var{prefixCls:s="w-color-editable-input",placement:r="bottom",label:n,value:l,className:c,style:d,labelStyle:i,inputStyle:p,onChange:h,onBlur:u,renderInput:f}=e,m=E(e,ma),[b,x]=N.useState(l),v=N.useRef(!1);N.useEffect(()=>{e.value!==b&&(v.current||x(e.value))},[e.value]);function g(k,D){var P=(D||k.target.value).trim().replace(/^#/,"");pa(P)&&h&&h(k,P);var _=ua(P);isNaN(_)||h&&h(k,_),x(P)}function o(k){v.current=!1,x(e.value),u&&u(k)}var w={};r==="bottom"&&(w.flexDirection="column"),r==="top"&&(w.flexDirection="column-reverse"),r==="left"&&(w.flexDirection="row-reverse");var S=y({"--editable-input-label-color":"rgb(153, 153, 153)","--editable-input-box-shadow":"rgb(204 204 204) 0px 0px 0px 1px inset","--editable-input-color":"#666",position:"relative",alignItems:"center",display:"flex",fontSize:11},w,d),C=y({width:"100%",paddingTop:2,paddingBottom:2,paddingLeft:3,paddingRight:3,fontSize:11,background:"transparent",boxSizing:"border-box",border:"none",color:"var(--editable-input-color)",boxShadow:"var(--editable-input-box-shadow)"},p),j=y({value:b,onChange:g,onBlur:o,autoComplete:"off",onFocus:()=>v.current=!0},m,{style:C});return a.jsxs("div",{className:[s,c||""].filter(Boolean).join(" "),style:S,children:[f?f(j,t):a.jsx("input",y({ref:t},j)),n&&a.jsx("span",{style:y({color:"var(--editable-input-label-color)",textTransform:"capitalize"},i),children:n})]})});T.displayName="EditableInput";var ha=["prefixCls","hsva","placement","rProps","gProps","bProps","aProps","className","style","onChange"],De=R.forwardRef((e,t)=>{var{prefixCls:s="w-color-editable-input-rgba",hsva:r,placement:n="bottom",rProps:l={},gProps:c={},bProps:d={},aProps:i={},className:p,style:h,onChange:u}=e,f=E(e,ha),m=r?q(r):{};function b(v){var g=Number(v.target.value);g&&g>255&&(v.target.value="255"),g&&g<0&&(v.target.value="0")}var x=(v,g,o)=>{typeof v=="number"&&(g==="a"&&(v<0&&(v=0),v>100&&(v=100),u&&u(I($(y({},m,{a:v/100}))))),v>255&&(v=255,o.target.value="255"),v<0&&(v=0,o.target.value="0"),g==="r"&&u&&u(I($(y({},m,{r:v})))),g==="g"&&u&&u(I($(y({},m,{g:v})))),g==="b"&&u&&u(I($(y({},m,{b:v})))))};return a.jsxs("div",y({ref:t,className:[s,p||""].filter(Boolean).join(" ")},f,{style:y({fontSize:11,display:"flex"},h),children:[a.jsx(T,y({label:"R",value:m.r||0,onBlur:b,placement:n,onChange:(v,g)=>x(g,"r",v)},l,{style:y({},l.style)})),a.jsx(T,y({label:"G",value:m.g||0,onBlur:b,placement:n,onChange:(v,g)=>x(g,"g",v)},c,{style:y({marginLeft:5},l.style)})),a.jsx(T,y({label:"B",value:m.b||0,onBlur:b,placement:n,onChange:(v,g)=>x(g,"b",v)},d,{style:y({marginLeft:5},d.style)})),i&&a.jsx(T,y({label:"A",value:m.a?parseInt(String(m.a*100),10):0,onBlur:b,placement:n,onChange:(v,g)=>x(g,"a",v)},i,{style:y({marginLeft:5},i.style)}))]}))});De.displayName="EditableInputRGBA";var fa=["prefixCls","className","hue","onChange","direction"],Ue=R.forwardRef((e,t)=>{var{prefixCls:s="w-color-hue",className:r,hue:n=0,onChange:l,direction:c="horizontal"}=e,d=E(e,fa);return a.jsx(V,y({ref:t,className:s+" "+(r||"")},d,{direction:c,background:"linear-gradient(to "+(c==="horizontal"?"right":"bottom")+", rgb(255, 0, 0) 0%, rgb(255, 255, 0) 17%, rgb(0, 255, 0) 33%, rgb(0, 255, 255) 50%, rgb(0, 0, 255) 67%, rgb(255, 0, 255) 83%, rgb(255, 0, 0) 100%)",hsva:{h:n,s:100,v:100,a:n/360},onChange:(i,p)=>{l&&l({h:c==="horizontal"?360*p.left:360*p.top})}}))});Ue.displayName="Hue";var ga=["prefixCls","className","color","colors","style","rectProps","onChange","addonAfter","addonBefore","rectRender"],Ie=R.forwardRef((e,t)=>{var{prefixCls:s="w-color-swatch",className:r,color:n,colors:l=[],style:c,rectProps:d={},onChange:i,addonAfter:p,addonBefore:h,rectRender:u}=e,f=E(e,ga),m=y({"--swatch-background-color":"rgb(144, 19, 254)",background:"var(--swatch-background-color)",height:15,width:15,marginRight:5,marginBottom:5,cursor:"pointer",position:"relative",outline:"none",borderRadius:2},d.style),b=(x,v)=>{i&&i(O(x),I(O(x)),v)};return a.jsxs("div",y({ref:t},f,{className:[s,r||""].filter(Boolean).join(" "),style:y({display:"flex",flexWrap:"wrap",position:"relative"},c),children:[h&&R.isValidElement(h)&&h,l&&Array.isArray(l)&&l.map((x,v)=>{var g="",o="";typeof x=="string"&&(g=x,o=x),typeof x=="object"&&x.color&&(g=x.title||x.color,o=x.color);var w=n&&n.toLocaleLowerCase()===o.toLocaleLowerCase(),S=u&&u({title:g,color:o,checked:!!w,style:y({},m,{background:o}),onClick:j=>b(o,j)});if(S)return a.jsx(N.Fragment,{children:S},v);var C=d.children&&R.isValidElement(d.children)?R.cloneElement(d.children,{color:o,checked:w}):null;return a.jsx("div",y({tabIndex:0,title:g,onClick:j=>b(o,j)},d,{children:C,style:y({},m,{background:o})}),v)}),p&&R.isValidElement(p)&&p]}))});Ie.displayName="Swatch";var va=["prefixCls","className","onChange","width","presetColors","color","editableDisable","disableAlpha","style"],ya=["#D0021B","#F5A623","#f8e61b","#8B572A","#7ED321","#417505","#BD10E0","#9013FE","#4A90E2","#50E3C2","#B8E986","#000000","#4A4A4A","#9B9B9B","#FFFFFF"],we=e=>a.jsx("div",{style:{boxShadow:"rgb(0 0 0 / 60%) 0px 0px 2px",width:4,top:1,bottom:1,left:e.left,borderRadius:1,position:"absolute",backgroundColor:"#fff"}}),Te=R.forwardRef((e,t)=>{var{prefixCls:s="w-color-sketch",className:r,onChange:n,width:l=218,presetColors:c=ya,color:d,editableDisable:i=!0,disableAlpha:p=!1,style:h}=e,u=E(e,va),[f,m]=N.useState({h:209,s:36,v:90,a:1});N.useEffect(()=>{typeof d=="string"&&J(d)&&m(O(d)),typeof d=="object"&&m(d)},[d]);var b=j=>{m(j),n&&n(I(j))},x=(j,k)=>{typeof j=="string"&&J(j)&&/(3|6)/.test(String(j.length))&&b(O(j))},v=j=>b(y({},f,{a:j.a})),g=j=>b(y({},f,j,{a:f.a})),o=y({"--sketch-background":"rgb(255, 255, 255)","--sketch-box-shadow":"rgb(0 0 0 / 15%) 0px 0px 0px 1px, rgb(0 0 0 / 15%) 0px 8px 16px","--sketch-swatch-box-shadow":"rgb(0 0 0 / 15%) 0px 0px 0px 1px inset","--sketch-alpha-box-shadow":"rgb(0 0 0 / 15%) 0px 0px 0px 1px inset, rgb(0 0 0 / 25%) 0px 0px 4px inset","--sketch-swatch-border-top":"1px solid rgb(238, 238, 238)",background:"var(--sketch-background)",borderRadius:4,boxShadow:"var(--sketch-box-shadow)",width:l},h),w={borderRadius:2,background:Ze(f),boxShadow:"var(--sketch-alpha-box-shadow)"},S={borderTop:"var(--sketch-swatch-border-top)",paddingTop:10,paddingLeft:10},C={marginRight:10,marginBottom:10,borderRadius:3,boxShadow:"var(--sketch-swatch-box-shadow)"};return a.jsxs("div",y({},u,{className:s+" "+(r||""),ref:t,style:o,children:[a.jsxs("div",{style:{padding:"10px 10px 8px"},children:[a.jsx(Be,{hsva:f,style:{width:"auto",height:150},onChange:g}),a.jsxs("div",{style:{display:"flex",marginTop:4},children:[a.jsxs("div",{style:{flex:1},children:[a.jsx(Ue,{width:"auto",height:10,hue:f.h,pointer:we,innerProps:{style:{marginLeft:1,marginRight:5}},onChange:j=>b(y({},f,j))}),!p&&a.jsx(V,{width:"auto",height:10,hsva:f,pointer:we,style:{marginTop:4},innerProps:{style:{marginLeft:1,marginRight:5}},onChange:v})]}),!p&&a.jsx(V,{width:24,height:24,hsva:f,radius:2,style:{marginLeft:4},bgProps:{style:{background:"transparent"}},innerProps:{style:w},pointer:()=>a.jsx(N.Fragment,{})})]})]}),i&&a.jsxs("div",{style:{display:"flex",margin:"0 10px 3px 10px"},children:[a.jsx(T,{label:"Hex",value:K(f).replace(/^#/,"").toLocaleUpperCase(),onChange:(j,k)=>x(k),style:{minWidth:58}}),a.jsx(De,{hsva:f,style:{marginLeft:6},aProps:p?!1:{},onChange:j=>b(j.hsva)})]}),c&&c.length>0&&a.jsx(Ie,{style:S,colors:c,color:K(f),onChange:j=>b(j),rectProps:{style:C}})]}))});Te.displayName="Sketch";function Ce({value:e,onChange:t,onBlur:s}){const r=N.useCallback(n=>{t==null||t(n.hex)},[t]);return a.jsx(Te,{disableAlpha:!0,onChange:r,onBlur:s,color:e})}const Se=(e,t,s)=>{if(e&&"reportValidity"in e){const r=W(s,t);e.setCustomValidity(r&&r.message||""),e.reportValidity()}},Fe=(e,t)=>{for(const s in t.fields){const r=t.fields[s];r&&r.ref&&"reportValidity"in r.ref?Se(r.ref,s,e):r&&r.refs&&r.refs.forEach(n=>Se(n,s,e))}},xa=(e,t)=>{t.shouldUseNativeValidation&&Fe(e,t);const s={};for(const r in e){const n=W(t.fields,r),l=Object.assign(e[r]||{},{ref:n&&n.ref});if(ba(t.names||Object.keys(e),r)){const c=Object.assign({},W(s,r));Y(c,"root",l),Y(s,r,c)}else Y(s,r,l)}return s},ba=(e,t)=>{const s=ke(t);return e.some(r=>ke(r).match(`^${s}\\.\\d+`))};function ke(e){return e.replace(/\]|\[/g,"")}function ja(e,t){for(var s={};e.length;){var r=e[0],n=r.code,l=r.message,c=r.path.join(".");if(!s[c])if("unionErrors"in r){var d=r.unionErrors[0].errors[0];s[c]={message:d.message,type:d.code}}else s[c]={message:l,type:n};if("unionErrors"in r&&r.unionErrors.forEach(function(h){return h.errors.forEach(function(u){return e.push(u)})}),t){var i=s[c].types,p=i&&i[r.code];s[c]=Ye(c,t,s,n,p?[].concat(p,r.message):r.message)}e.shift()}return s}function Na(e,t,s){return s===void 0&&(s={}),function(r,n,l){try{return Promise.resolve(function(c,d){try{var i=Promise.resolve(e[s.mode==="sync"?"parse":"parseAsync"](r,t)).then(function(p){return l.shouldUseNativeValidation&&Fe({},l),{errors:{},values:s.raw?Object.assign({},r):p}})}catch(p){return d(p)}return i&&i.then?i.then(void 0,d):i}(0,function(c){if(function(d){return Array.isArray(d==null?void 0:d.errors)}(c))return{values:{},errors:xa(ja(c.errors,!l.shouldUseNativeValidation&&l.criteriaMode==="all"),l)};throw c}))}catch(c){return Promise.reject(c)}}}async function wa(){const e=await fetch("/jsons/rulesets/index.json");if(!e.ok)throw new Error(`Response status: ${e.status}`);return await e.json()}async function Ca(e){const t=await fetch(`/jsons/rulesets/entries/${e}.json`);if(!t.ok)throw new Error(`Response status: ${t.status}`);return await t.json()}function Sa(){return Q({queryKey:["v2-rulesets"],queryFn:wa,placeholderData:Ae})}function ka(e){return Q({queryKey:["v2-rulesets",e],queryFn:({queryKey:t})=>Ca(t[1]),enabled:!!e,initialData:void 0,placeholderData:Ae})}function Aa({score:e,scoreChanges:t=[],point:s,ranking:r,isEast:n,isRiichi:l,isYellowCarded:c,isRedCarded:d,isRonDisallowed:i,waitingTiles:p,showPointAndRanking:h,className:u,player:f,...m}){var w,S;const[b,x]=N.useState(e),[v,g]=N.useState(null),o=N.useMemo(()=>!!v,[v]);return N.useEffect(()=>{e!==b&&(g(t),setTimeout(()=>{x(e)},2550),setTimeout(()=>{g(null)},3e3))},[e,t,b]),a.jsxs("div",{className:"relative min-w-[5.35em] mx-auto [&_.hide-if-changing]:transition-opacity data-[score-changing='1']:[&_.hide-if-changing]:opacity-0 overflow-visible","data-score-changing":o?"1":"0",children:[a.jsxs("div",{className:"absolute top-[0.05em] bottom-[0.15em] -left-[0.1em] -right-[0.1em] rounded-[0.1em] overflow-hidden -z-50",children:[c&&a.jsx("div",{className:"absolute top-0 left-0 w-[200%] aspect-square animate-[yellowPenaltyAni_8s_ease-in-out_1]"}),d&&a.jsx("div",{className:"absolute top-0 left-0 w-[200%] aspect-square animate-[redPenaltyAni_8s_ease-in-out_1]"})]}),c&&a.jsx("div",{className:"absolute -top-[0.4em] left-0 h-[0.5em] w-[0.37em] bg-[#ffe100] rounded-[0.05em]"}),d&&a.jsx("div",{className:"absolute -top-[0.4em] left-[0.45em] h-[0.5em] w-[0.37em] bg-[#ff1900] rounded-[0.05em]"}),a.jsxs("div",{className:"flex items-end gap-x-[0.1em]",children:[a.jsxs("div",{className:"shrink-0 w-[1.75em] h-full relative -bottom-[0.085em] -left-[0.085em]",children:[a.jsx("div",{className:"absolute w-full h-full bg-[#d1b571] overflow-hidden rounded-[0.1em]",style:{opacity:l?1:0},children:a.jsx("div",{className:"origin-bottom w-[200%] h-[100%] bg-[#d1291d] animate-[riichi_8s_ease-in-out_infinite]"})}),a.jsx("div",{className:"relative z-10 w-full aspect-90/125 p-[0.085em]",children:a.jsxs("div",{className:"w-full h-full bg-white rounded-[0.08em] overflow-hidden",style:{background:`linear-gradient(180deg, ${f.color.primary}, ${f.color.secondary})`},children:[((w=f.image.logo)==null?void 0:w.default.url)&&a.jsx("div",{className:"absolute inset-[0.085em] overflow-hidden",children:a.jsx("img",{className:"absolute max-w-[none] h-[2.2em] w-[2.2em] opacity-30 animate-[scrollFromRightToLeft_12s_linear_infinite]",src:f.image.logo.default.url,alt:f.name.display.primary})}),((S=f.image.portrait)==null?void 0:S.default.url)&&a.jsx("img",{className:"relative z-10 w-full h-full rounded-[0.08em]",src:f.image.portrait.default.url,alt:f.name.display.primary}),f.name.display.third&&a.jsx("div",{className:"absolute bottom-[0.085em] left-[0.085em] right-[0.085em] rounded-b-[0.08em] bg-[linear-gradient(to_top,#00000060,#00000050_70%,transparent)] text-white z-20",children:a.jsx("p",{className:"text-center text-[0.25em] font-semibold pb-[0.25em] pt-[0.5em]",children:f.name.display.third})})]})})]}),a.jsxs("div",{className:"flex-1 flex flex-col gap-y-[0.125em] items-start justify-end",children:[a.jsxs("div",{className:"flex gap-[0.125em] relative self-stretch",children:[a.jsx("div",{className:"absolute inset-0 flex items-end",children:a.jsxs("div",{className:"text-center bg-red-600 text-[0.3em] flex gap-x-[0.2em] px-[1em] opacity-0 transition-opacity hide-if-changing cursor-pointer",style:{opacity:i?1:0},children:[a.jsx("i",{className:"bi bi-ban"})," 和了禁止"]})}),a.jsxs("div",{className:"bg-black/50 rounded-sm text-[0.5em] flex gap-x-[0.2em] p-[0.1em] pl-[0.2em] pr-[0.2em] opacity-0 transition-opacity data-[has-waiting-tiles='1']:opacity-100 hide-if-changing cursor-pointer","data-has-waiting-tiles":p&&p.length>0?"1":"0",children:[a.jsx("div",{className:"flex-1 leading-none min-h-[1.19em] flex flex-wrap gap-[0.15em]",children:p==null?void 0:p.map(C=>a.jsx(Ke,{className:"inline-block align-bottom w-[0.85em] animate-[fadeInFromLeft_1s_ease-in-out]",children:C},C))}),a.jsx("div",{className:"bg-[#FFFFFF] w-[4px]"}),a.jsxs("div",{className:"text-[#FFFFFF] text-[0.4em] leading-[1.3em] flex items-center",children:["待",a.jsx("br",{}),"牌"]})]})]}),a.jsxs("div",{className:`relative w-full text-left bg-white px-[0.1em] pb-[0.05em] pt-[0.08em] ${u}`,...m,style:{background:`linear-gradient(260deg, transparent, transparent 22px, ${f.color.secondary} 23px, ${f.color.primary} 100%`,textShadow:"#00000048 2px 2px 3px, #00000048 -2px -2px 3px, #00000048 -2px 2px 3px, #00000048 2px -2px 3px, #00000048 0 0 6px"},children:[a.jsxs("div",{className:"flex flex-col justify-center gap-y-[0.075em] mt-[0.04em]",children:[a.jsx("div",{className:"text-[0.1875em] ml-[0.1em] leading-none text-white hide-if-changing font-semibold whitespace-nowrap",children:f.name.display.secondary||"　"}),a.jsx("div",{className:"text-[0.3125em] ml-[0.1em] leading-none text-white hide-if-changing font-semibold whitespace-nowrap",style:{transformOrigin:"left",transform:(f.name.display.primary||"").length>=17?"scaleX(0.9)":"scaleX(1)"},children:f.name.display.primary})]}),v&&a.jsx("div",{className:"absolute bottom-[2.75em] pr-[0.125em] left-0 text-[0.5625em] leading-none animate-[drop_3s_ease-in-out] font-numeric",children:v.map(C=>a.jsx("div",{children:a.jsx(xe,{signed:!0,value:C,positiveClassName:"text-[#09eb09]",negativeClassName:"text-[#eb0000]"})}))}),a.jsxs("div",{className:"relative mt-[0.12em] mb-[0.03em]",children:[a.jsx("p",{className:"relative text-[0.5625em] flex-1 leading-none text-white font-numeric",style:{transition:"opacity 1s, bottom 1s",opacity:h?0:1,bottom:h?"1em":0},children:a.jsx(xe,{animated:!0,value:b})}),a.jsxs("p",{className:"absolute left-0 right-[0.25em] text-[0.5625em] flex-1 leading-none text-white font-numeric",style:{transition:"opacity 1s, bottom 1s",opacity:h?1:0,bottom:h?0:"-1em"},children:[Le(s),a.jsx("span",{className:"text-[0.8em]",children:"pt"}),a.jsx("span",{className:"absolute right-0 bottom-0 text-[0.75em]",children:$e(r)})]})]})]})]})]}),a.jsx("div",{className:`mt-[0.2em] h-[0.075em] rounded-full ${n&&"bg-red-500"}`})]})}const Ra=["東家","南家","西家","北家"],Pa=ge({name:A({required_error:"必須填寫對局名稱。"}),nameAlt:A().optional(),rulesetId:A({required_error:"必須選擇其中一套規則。"}),players:ze(ge({namePrimary:A({required_error:"玩家必須有名稱"}),nameSecondary:A(),nameThird:A(),colorPrimary:A({required_error:"玩家必須有主要顏色"}).regex(/^#[0-9A-F]{6}$/i,"顏色必須是 #ABCDEF 格式。"),colorSecondary:A({required_error:"玩家必須有次要顏色"}).regex(/^#[0-9A-F]{6}$/i,"顏色必須是 #ABCDEF 格式。"),imagePortraitUrl:A().url("玩家圖片必須是URL。").optional(),imageLogoUrl:A().url("隊伍圖片／立直圖片必須是URL。").optional(),imagePortraitAltUrl:A().url("玩家圖片必須是URL。").optional(),imageRiichiUrl:A().url("玩家圖片必須是URL。").optional()}))});function Ea({onSubmit:e,defaultValues:t,autoSubmit:s}){var x,v;const{data:r=[]}=Sa(),{control:n,register:l,handleSubmit:c,reset:d,formState:i}=We({resolver:Na(Pa),defaultValues:t}),p=ve({name:"rulesetId",control:n}),{data:h}=ka(p),u=ve({name:"players",control:n}),f=N.useCallback(g=>{if(!h)return;const o=parseInt(g.currentTarget.getAttribute("data-player-index"));if(typeof o!="number")return;const w=(o+1+h.data.playerCount)%h.data.playerCount;d(S=>{const C=[...S.players];return[C[o],C[w]]=[C[w],C[o]],{...S,players:C}})},[d,h]),m=N.useMemo(()=>c(g=>{e({schemaVersion:"v20250403",code:Re(),data:{name:{official:{primary:g.name},display:{primary:g.nameAlt||g.name}},remark:"",players:g.players.map(o=>({id:"",name:{display:{primary:o.namePrimary,secondary:o.nameSecondary,third:o.nameThird},official:{primary:o.namePrimary,secondary:o.nameSecondary,third:o.nameThird}},color:{primary:o.colorPrimary,secondary:o.colorSecondary},image:{portrait:o.imagePortraitUrl?{default:{url:o.imagePortraitUrl}}:void 0,portraitAlt:o.imagePortraitAltUrl?{default:{url:o.imagePortraitAltUrl}}:void 0,riichi:o.imageRiichiUrl?{default:{url:o.imageRiichiUrl}}:void 0}})),rulesetRef:g.rulesetId},metadata:{createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()}})}),[c,e]),b=N.useCallback(()=>{d(t)},[t,d]);return N.useEffect(()=>{t&&d(t)},[t,d]),N.useEffect(()=>{s&&m&&m()},[m]),r.length===0?a.jsx("div",{children:"讀取中…"}):a.jsxs("form",{onSubmit:m,children:[a.jsx("input",{type:"text",className:"bg-base-200 input input-xl input-ghost w-full",placeholder:"玩家名稱",...l("name")}),a.jsx("label",{className:"fieldset-label mt-8",children:"直播顯示名稱"}),a.jsx("input",{type:"text",className:"input",placeholder:"直播顯示名稱",...l("nameAlt")}),a.jsx("p",{className:"fieldset-label text-error",children:(x=i.errors.nameAlt)==null?void 0:x.message}),a.jsx("h4",{className:"mt-4",children:"規則"}),a.jsxs("fieldset",{className:"fieldset",children:[a.jsx("select",{className:"select",...l("rulesetId"),children:r.map(g=>a.jsx("option",{value:g.id,children:g.metadata.name.display}))}),a.jsx("p",{className:"fieldset-label text-error",children:(v=i.errors.rulesetId)==null?void 0:v.message})]}),a.jsx("div",{className:"divider"}),a.jsx("h4",{children:"玩家"}),a.jsx("div",{className:"flex gap-x-4",children:new Array(h==null?void 0:h.data.playerCount).fill(void 0).map((g,o)=>{var w,S,C,j,k,D,P,_,F,L,ee,ae,re,te,se,le,oe,ie,ne,de,ce,me,pe,ue,he,fe;return a.jsx("div",{className:"flex-1",children:a.jsxs("fieldset",{className:"relative fieldset border-2 border-base-300 p-4 rounded-box",style:{borderColor:(w=u==null?void 0:u[o])==null?void 0:w.colorPrimary,backgroundColor:`${(S=u==null?void 0:u[o])==null?void 0:S.colorPrimary}20`},children:[a.jsx("legend",{className:"fieldset-legend",children:Ra[o]}),a.jsx("label",{className:"fieldset-label",children:"名稱"}),a.jsx("input",{type:"text",className:"input",placeholder:"玩家名稱",...l(`players.${o}.namePrimary`)}),a.jsx("p",{className:"fieldset-label text-error",children:(k=(j=(C=i.errors.players)==null?void 0:C[o])==null?void 0:j.namePrimary)==null?void 0:k.message}),a.jsx("label",{className:"fieldset-label",children:"稱號"}),a.jsx("input",{type:"text",className:"input",placeholder:"玩家名稱",...l(`players.${o}.nameSecondary`)}),a.jsx("p",{className:"fieldset-label text-error",children:(_=(P=(D=i.errors.players)==null?void 0:D[o])==null?void 0:P.nameSecondary)==null?void 0:_.message}),a.jsx("label",{className:"fieldset-label",children:"暱稱"}),a.jsx("input",{type:"text",className:"input",placeholder:"玩家名稱",...l(`players.${o}.nameThird`)}),a.jsx("p",{className:"fieldset-label text-error",children:(ee=(L=(F=i.errors.players)==null?void 0:F[o])==null?void 0:L.nameThird)==null?void 0:ee.message}),a.jsx("label",{className:"fieldset-label",children:"顏色"}),a.jsx(ye,{control:n,name:`players.${o}.colorPrimary`,render:({field:{onChange:G,onBlur:M,value:X}})=>a.jsx(Ce,{onChange:G,onBlur:M,value:X})}),a.jsx("p",{className:"fieldset-label text-error",children:(te=(re=(ae=i.errors.players)==null?void 0:ae[o])==null?void 0:re.colorPrimary)==null?void 0:te.message}),a.jsx("label",{className:"fieldset-label",children:"次顏色"}),a.jsx(ye,{control:n,name:`players.${o}.colorSecondary`,render:({field:{onChange:G,onBlur:M,value:X}})=>a.jsx(Ce,{onChange:G,onBlur:M,value:X})}),a.jsx("p",{className:"fieldset-label text-error",children:(oe=(le=(se=i.errors.players)==null?void 0:se[o])==null?void 0:le.colorSecondary)==null?void 0:oe.message}),a.jsx("label",{className:"fieldset-label",children:"圖片"}),a.jsx("input",{type:"text",className:"input w-full",placeholder:"https://....png",...l(`players.${o}.imagePortraitUrl`)}),a.jsx("p",{className:"fieldset-label text-error",children:(de=(ne=(ie=i.errors.players)==null?void 0:ie[o])==null?void 0:ne.imagePortraitUrl)==null?void 0:de.message}),a.jsx("label",{className:"fieldset-label",children:"隊伍圖片"}),a.jsx("input",{type:"text",className:"input w-full",placeholder:"https://....png",...l(`players.${o}.imageLogoUrl`)}),a.jsx("p",{className:"fieldset-label text-error",children:(pe=(me=(ce=i.errors.players)==null?void 0:ce[o])==null?void 0:me.imageLogoUrl)==null?void 0:pe.message}),a.jsx("label",{className:"fieldset-label",children:"立直圖片"}),a.jsx("input",{type:"text",className:"input w-full",placeholder:"https://....png",...l(`players.${o}.imageRiichiUrl`)}),a.jsx("p",{className:"fieldset-label text-error",children:(fe=(he=(ue=i.errors.players)==null?void 0:ue[o])==null?void 0:he.imageRiichiUrl)==null?void 0:fe.message}),a.jsx("div",{className:"divider"}),a.jsx("label",{className:"fieldset-label",children:"預覽"}),(u==null?void 0:u[o])&&a.jsxs("div",{children:[a.jsx("div",{className:"w-full text-[48px]",children:a.jsx(Aa,{score:(h==null?void 0:h.data.startingPoint)??0,player:{id:"",name:{official:{primary:u[o].namePrimary,secondary:u[o].nameSecondary,third:u[o].nameThird},display:{primary:u[o].namePrimary,secondary:u[o].nameSecondary,third:u[o].nameThird}},color:{primary:u[o].colorPrimary,secondary:u[o].colorSecondary},image:{portrait:{default:{url:u[o].imagePortraitUrl}}}}})},o),a.jsxs("div",{className:"grid grid-cols-2",children:[a.jsx("img",{className:"w-full aspect-square",src:u[o].imageLogoUrl,alt:""}),a.jsx("img",{className:"w-full aspect-square",src:u[o].imageRiichiUrl,alt:""})]})]}),a.jsx("button",{type:"button",className:"z-10 absolute btn rounded-full -right-8 -top-4 shadow",onClick:f,"data-player-index":o,children:a.jsx("i",{className:"bi bi-arrow-left-right"})})]})},o)})}),a.jsxs("div",{className:"text-center mt-8 space-x-8",children:[a.jsx("button",{type:"button",onClick:b,className:"btn btn-lg btn-ghost",children:"重置"}),a.jsx("button",{type:"submit",className:"btn btn-primary btn-lg",children:"建立對局"})]})]})}function La(){const e=Oe(),{matchId:t}=He(),[s]=Ve(),[,r]=qe(),{data:n}=Me(),{data:l}=Q({queryKey:["v2-matches",t],queryFn:({queryKey:i})=>Xe(i[1])}),c=N.useCallback(async i=>{var m,b,x,v,g,o,w,S,C,j,k,D,P,_,F,L;if(!l||!n||!confirm("確定資料都正確了嗎？要開始對局了嗎？"))return;const h={code:Re(),name:i.data.name.official.primary,nameDisplay:(i.data.name.display??i.data.name.official).primary,databaseId:t,remark:"",createdAt:new Date().toISOString(),createdBy:"Dicky",updatedAt:new Date().toISOString(),updatedBy:"Dicky",setting:{startingScore:"25000",isManganRoundUp:"1",yakuMax:"12",yakumanMax:"13"},players:{0:{primaryName:i.data.players[0].name.display.primary,secondaryName:i.data.players[0].name.display.secondary??"",nickname:i.data.players[0].name.display.third??"",color:i.data.players[0].color.primary,logoUrl:((m=i.data.players[0].image.logo)==null?void 0:m.default.url)??"",propicUrl:((b=i.data.players[0].image.portrait)==null?void 0:b.default.url)??"",largeLogoUrl:((x=i.data.players[0].image.riichi)==null?void 0:x.default.url)??((v=i.data.players[0].image.logo)==null?void 0:v.default.url)??""},1:{primaryName:i.data.players[1].name.display.primary,secondaryName:i.data.players[1].name.display.secondary??"",nickname:i.data.players[1].name.display.third??"",color:i.data.players[1].color.primary,logoUrl:((g=i.data.players[1].image.logo)==null?void 0:g.default.url)??"",propicUrl:((o=i.data.players[1].image.portrait)==null?void 0:o.default.url)??"",largeLogoUrl:((w=i.data.players[1].image.riichi)==null?void 0:w.default.url)??((S=i.data.players[1].image.logo)==null?void 0:S.default.url)??""},2:{primaryName:i.data.players[2].name.display.primary,secondaryName:i.data.players[2].name.display.secondary??"",nickname:i.data.players[2].name.display.third??"",color:i.data.players[2].color.primary,logoUrl:((C=i.data.players[2].image.logo)==null?void 0:C.default.url)??"",propicUrl:((j=i.data.players[2].image.portrait)==null?void 0:j.default.url)??"",largeLogoUrl:((k=i.data.players[2].image.riichi)==null?void 0:k.default.url)??((D=i.data.players[2].image.logo)==null?void 0:D.default.url)??""},3:{primaryName:i.data.players[3].name.display.primary,secondaryName:i.data.players[3].name.display.secondary??"",nickname:i.data.players[3].name.display.third??"",color:i.data.players[3].color.primary,logoUrl:((P=i.data.players[3].image.logo)==null?void 0:P.default.url)??"",propicUrl:((_=i.data.players[3].image.portrait)==null?void 0:_.default.url)??"",largeLogoUrl:((F=i.data.players[3].image.riichi)==null?void 0:F.default.url)??((L=i.data.players[3].image.logo)==null?void 0:L.default.url)??""}},activeResultDetail:null};await e.set(`matches/${h.code}`,h);const u=25e3,f={matchId:h.code,code:Ge(h.code,1,0),roundCount:1,extendedRoundCount:0,cumulatedThousands:0,nextRoundCumulatedThousands:0,resultType:0,nextRoundType:0,playerResults:{0:{beforeScore:u,afterScore:u,type:0,scoreChanges:[],prevScoreChanges:[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}},1:{beforeScore:u,afterScore:u,type:0,scoreChanges:[],prevScoreChanges:[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}},2:{beforeScore:u,afterScore:u,type:0,scoreChanges:[],prevScoreChanges:[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}},3:{beforeScore:u,afterScore:u,type:0,scoreChanges:[],prevScoreChanges:[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}}},doras:[]};await e.push("matchRounds",f),await e.update("obs/1",{tournamentId:n.tournament.id??null,matchId:h.code,themeId:n.tournament.themeId??"default"}),r("/obs/match-control")},[e,l,t,r,n]),d=N.useMemo(()=>{var i;if(l&&n)return{name:l.data.name.official.primary,nameAlt:((i=l.data.name.display)==null?void 0:i.primary)||"",rulesetId:l.data.rulesetRef,players:[n.playersMap[l.data.players[0].id]??l.data.players[0],n.playersMap[l.data.players[1].id]??l.data.players[1],n.playersMap[l.data.players[2].id]??l.data.players[2],n.playersMap[l.data.players[3].id]??l.data.players[3]].map(p=>{var h,u,f,m;return{namePrimary:p.name.display.primary,nameSecondary:p.name.display.secondary??"",nameThird:p.name.display.third??"",colorPrimary:p.color.primary,colorSecondary:p.color.secondary??p.color.primary,imagePortraitUrl:(h=p.image.portrait)==null?void 0:h.default.url,imageLogoUrl:(u=p.image.logo)==null?void 0:u.default.url,imageRiichiUrl:((f=p.image.riichi)==null?void 0:f.default.url)??((m=p.image.logo)==null?void 0:m.default.url)}})}},[l,n]);return l?a.jsx(a.Fragment,{children:a.jsx("section",{className:"container mx-6 my-4",children:a.jsx(Ea,{defaultValues:d,onSubmit:c,autoSubmit:!!s.get("autoSubmit")})})}):a.jsx(a.Fragment,{})}export{La as default};
