import{j as e,d as X,c as b,u as Y,r as y,B as k,m as te}from"./index-XMqLaEd9.js";import{c as x}from"./index-D0mthNPE.js";import{R as re,L as ae,C as se,X as le,Y as oe,a as h}from"./LineChart-Bdl3FIT6.js";import{u as ie}from"./index-gSX6M8qi.js";import{u as ne}from"./mahjong.helper-czAoz2vP.js";import{b as ce}from"./match.service-sGZICpZH.js";import"./tiny-invariant-BaFNuDhB.js";function pe({players:r,rounds:a}){return e.jsx(re,{width:"100%",height:"100%",children:e.jsxs(ae,{data:a,children:[e.jsx(se,{strokeDasharray:"3 3"}),e.jsx(le,{tick:{fill:"#78012c"},dataKey:"name"}),e.jsx(oe,{tick:{fill:"#78012c"},tickCount:6,width:120,allowDecimals:!1}),e.jsx(h,{type:"linear",stroke:r.playerNorth.strokeColor??"#FFF",strokeWidth:10,isAnimationActive:!1,dataKey:"playerNorth"}),e.jsx(h,{type:"linear",stroke:r.playerNorth.color,strokeWidth:8,isAnimationActive:!1,name:r.playerNorth.name,dataKey:"playerNorth"}),e.jsx(h,{type:"linear",stroke:r.playerWest.strokeColor??"#FFF",strokeWidth:10,isAnimationActive:!1,dataKey:"playerWest"}),e.jsx(h,{type:"linear",stroke:r.playerWest.color,strokeWidth:8,isAnimationActive:!1,name:r.playerWest.name,dataKey:"playerWest"}),e.jsx(h,{type:"linear",stroke:r.playerSouth.strokeColor??"#FFF",strokeWidth:10,isAnimationActive:!1,dataKey:"playerSouth"}),e.jsx(h,{type:"linear",stroke:r.playerSouth.color,strokeWidth:8,isAnimationActive:!1,name:r.playerSouth.name,dataKey:"playerSouth"}),e.jsx(h,{type:"linear",stroke:r.playerEast.strokeColor??"#FFF",strokeWidth:10,isAnimationActive:!1,dataKey:"playerEast"}),e.jsx(h,{type:"linear",stroke:r.playerEast.color,strokeWidth:8,isAnimationActive:!1,name:r.playerEast.name,dataKey:"playerEast"})]})})}const H={"match-introduction":"_match-introduction_1pt7p_239","twr-players-ranking":"_twr-players-ranking_1pt7p_338"};function K({player:r,ranking:a,point:m,active:t}){var i;return e.jsxs("div",{className:"relative text-right p-4 rounded-[1em]",style:{background:r.color.primary,opacity:t===!0?1:.25},children:[e.jsx("div",{className:"absolute -top-4 left-[4em] bottom-0 overflow-hidden",children:e.jsx("img",{src:(i=r.image.portrait)==null?void 0:i.default.url,className:"aspect-[18/25] w-[8em]"})}),e.jsxs("div",{className:"w-full h-[3em] flex items-center justify-between text-white",children:[e.jsx("div",{className:"text-left w-[6em] text-[2em]",children:X(a)}),e.jsx("div",{className:"flex-1 text-[2em] leading-[1em] text-left",children:r.name.display.primary}),e.jsx("div",{className:"text-[2em] leading-[1em]",children:b(m)})]})]})}const de=r=>Y({queryKey:["matches",r],queryFn:({queryKey:a})=>ce(a[1]),enabled:!!r}),p=[{strokeColor:"#77475b",bgColor:"#562135C0",color:"#f9dddc"},{strokeColor:"#c68fa7",bgColor:"#c3829eC0",color:"#77475b"},{strokeColor:"#e4b2ca",bgColor:"#e9b1cdC0",color:"#77475b"},{strokeColor:"#f9dddc",bgColor:"#ffe7deC0",color:"#77475b"}],me=({slide:r,status:a,subslide:m})=>r.type==="teams"?e.jsxs("div",{className:"text-[#78012c] absolute px-24 inset-0 flex flex-col justify-center items-stretch",style:{opacity:a>=0&&a<1?1:0},children:[e.jsx("div",{className:"flex-1"}),e.jsx("div",{className:"flex-3 grid grid-cols-4 items-center",children:["playerEast","playerSouth","playerWest","playerNorth"].map((t,i)=>e.jsxs("div",{className:x("relative h-full overflow-hidden",{"mi-teams-in":a===0,"mi-teams-out":a>0}),style:{animationDelay:a===0?i*.25+"s":"0s",opacity:r.teamAndPlayers[t].result.ranking!=="1"?1:.5},children:[e.jsx("div",{className:"absolute inset-0 -z-10 border-l-1 border-r-1 border-[#d41737C0]",style:{background:`linear-gradient(to bottom, transparent, ${r.teamAndPlayers[t].player.color})`,opacity:.5}}),e.jsx("div",{className:"absolute inset-0 -z-10",style:{background:`url(${r.teamAndPlayers[t].player.largeLogoUrl+"?w=800&h=800&auto=format"})`,backgroundRepeat:"no-repeat",backgroundPosition:"center center",opacity:.05}}),e.jsxs("div",{className:x("absolute bottom-0 left-0 right-0",{"mi-teams-team-out":a>=0&&m>0}),children:[e.jsx("h3",{className:"text-[2em] font-semibold text-center font-kurewa",style:{color:r.teamAndPlayers[t].player.color},children:r.teamAndPlayers[t].player.primaryName}),e.jsxs("h3",{className:"text-[1.5em] leading-[1em] font-semibold text-center flex justify-between px-[1em] mb-6",children:[e.jsx("div",{className:"px-4 py-1",style:{background:p[(parseInt(r.teamAndPlayers[t].result.ranking)??1)-1].bgColor,color:p[(parseInt(r.teamAndPlayers[t].result.ranking)??1)-1].color},children:X(r.teamAndPlayers[t].result.ranking)}),e.jsx("span",{children:b(r.teamAndPlayers[t].result.point)})]}),e.jsx("img",{src:r.teamAndPlayers[t].player.propicUrl,className:"w-full",alt:""})]})]},t))})]}):r.type==="players"?e.jsxs("div",{className:"absolute px-24 pb-24 inset-0 flex flex-col justify-center items-stretch",style:{opacity:a>=0&&a<1?1:0},children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex-3 flex flex-col items-stretch gap-y-[0.25em]",children:[e.jsxs("div",{className:x("flex gap-x-[1em] pl-[1em] mb-[.5em] items-end",{"mi-teams-in":a===0,"mi-teams-out":a>0}),children:[e.jsxs("div",{className:"flex-5 space-x-[1.5em] text-[1.1em]",children:[e.jsxs("span",{children:[e.jsx("span",{className:"text-[1.5em]",children:r.roundCount})," 總局數"]}),e.jsxs("span",{className:"opacity-80",children:["（"," ",e.jsx("span",{className:"text-[1.5em]",children:r.exhaustedRoundCount})," ","流局數 ）"]})]}),e.jsx("div",{className:"flex-1 text-right text-[.9em] font-semibold",children:"分數"}),e.jsx("div",{className:"flex-1 text-right text-[.9em] font-semibold",children:"立直次數"}),e.jsx("div",{className:"flex-1 text-right text-[.9em] font-semibold",children:"和了次數"}),e.jsx("div",{className:"flex-1 text-right text-[.9em] font-semibold pr-8",children:"放銃次數"})]}),r.teamAndPlayers.map(({player:t,result:i},n)=>e.jsxs("div",{className:x("text-[#78012c] relative overflow-hidden flex-1 border-1 border-[#78012c] rounded-[0.5em]",{"mi-teams-in":a===0,"mi-teams-out":a>0}),style:{animationDelay:a===0?n*.25+"s":"0s",background:p[n].bgColor,color:p[n].color},children:[e.jsx("div",{className:"absolute inset-0 -z-10"}),e.jsx("div",{className:"absolute inset-0 -z-10",style:{background:`url(${t.largeLogoUrl+"?w=800&h=800&auto=format"})`,backgroundRepeat:"no-repeat",backgroundPosition:"center center",opacity:.05}}),e.jsxs("div",{className:x("absolute inset-0 flex gap-x-[1em] items-center pl-[1em]",{"mi-teams-team-out":a>=0&&m>0}),children:[e.jsx("div",{className:"text-left flex-5",children:e.jsx("h3",{className:"text-[1.5em] font-semibold font-kurewa",children:t.primaryName})}),e.jsxs("div",{className:"flex-1 text-right",children:[e.jsx("p",{className:"text-[1.5em] leading-[1em]",children:k(i.score)}),e.jsx("p",{children:b(i.point)})]}),e.jsxs("div",{className:"flex-1 text-right",children:[e.jsx("span",{className:"text-[1.5em]",children:k(i.riichiCount)}),"回"]}),e.jsxs("div",{className:"flex-1 text-right",children:[e.jsx("span",{className:"text-[1.5em]",children:k(i.ronCount)}),"回"]}),e.jsxs("div",{className:"flex-1 text-right pr-8",children:[e.jsx("span",{className:"text-[1.5em]",children:k(i.chuckCount)}),"回"]})]})]},n))]})]}):r.type==="chart"?e.jsxs("div",{className:"text-[#78012c] absolute py-16 px-24 inset-0 flex flex-col justify-center items-stretch",style:{opacity:a>=0&&a<1?1:0},children:[e.jsx("div",{className:"flex-1"}),e.jsxs("div",{className:"flex-3 flex items-stretch gap-x-[1em]",children:[e.jsx("div",{className:x("flex-3 bg-white/25 p-4",{"mi-chart-chart-in":a===0,"mi-chart-chart-out":a>0}),children:e.jsx(pe,{rounds:r.rounds,players:r.players})}),e.jsx("div",{className:"flex-1 flex flex-col pb-[1em]",children:[0,1,2,3].map(t=>e.jsx("div",{className:x("relative overflow-hidden flex-1 px-[.5em] flex flex-col justify-center border-t-1 border-b-1 border-[#78012c]",{"mi-chart-player-in":a===0,"mi-chart-player-out":a>0}),style:{color:p[t].color,background:p[t].bgColor,animationDelay:a===0?t*.25+"s":"0s"},children:e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{children:e.jsx("p",{className:"text-[1.25em] leading-[1em] font-kurewa",children:r.teamAndPlayers[t].player.primaryName})}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[1.25em] leading-[1em]",children:r.teamAndPlayers[t].result.score}),e.jsx("p",{className:"text-[.75em]",children:b(r.teamAndPlayers[t].result.point)})]})]})},t))})]})]}):r.type==="grand-ranking"?e.jsx("div",{className:`absolute top-[20vh] left-[5vw] right-[5vw] flex flex-col font-kurewa ${H["twr-players-ranking"]}`,"data-active":a===0,children:e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 text-[0.5em] mt-8",children:[e.jsx("div",{className:"space-y-4",children:r.players.slice(0,8).map((t,i)=>e.jsx("div",{className:"twr-players-ranking-item",style:{"--transition-in-delay":`${((i+1)*.08).toFixed(2)}s`,"--transition-out-delay":"0s"},children:e.jsx(K,{...t,ranking:i+1})},t.player.id))}),e.jsx("div",{className:"space-y-4",children:r.players.slice(8,16).map((t,i)=>e.jsx("div",{className:"twr-players-ranking-item",style:{"--transition-in-delay":`${((i+4)*.08).toFixed(2)}s`,"--transition-out-delay":"0s"},children:e.jsx(K,{...t,ranking:i+9})},t.player.id))})]})}):e.jsx(e.Fragment,{}),je=({params:{matchId:r},forwardFlag:a,resetFlag:m})=>{const{rtMatch:t,rtMatchRounds:i}=ie(r),{data:n}=de(t==null?void 0:t.databaseId),{data:v}=Y({queryKey:["tournament",n==null?void 0:n.data.tournamentId],queryFn:()=>te(n==null?void 0:n.data.tournamentId),enabled:!!(n!=null&&n.data.tournamentId),staleTime:5*60*1e3}),C=y.useMemo(()=>{var I,R,F,M,_,$,D,T,L,q,z,B,G,U;if(!t||!i)return[{type:"empty",_id:"empty",subslide:0}];const l=ne(Object.values(i)),c=[{type:"empty",_id:"empty",subslide:0},{type:"teams",_id:"teams",teamAndPlayers:{playerEast:{player:t.players[0],result:{point:l.result.playerEast.point,ranking:l.result.playerEast.ranking}},playerSouth:{player:t.players[1],result:{point:l.result.playerSouth.point,ranking:l.result.playerSouth.ranking}},playerWest:{player:t.players[2],result:{point:l.result.playerWest.point,ranking:l.result.playerWest.ranking}},playerNorth:{player:t.players[3],result:{point:l.result.playerNorth.point,ranking:l.result.playerNorth.ranking}}},subslide:1}],o={playerEast:{score:((I=l.result.playerEast)==null?void 0:I.score)??25e3,point:((R=l.result.playerEast)==null?void 0:R.point)??0,ranking:((F=l.result.playerEast)==null?void 0:F.ranking)??"1",ronCount:0,riichiCount:0,chuckCount:0,scores:[25e3]},playerSouth:{score:((M=l.result.playerSouth)==null?void 0:M.score)??25e3,point:((_=l.result.playerSouth)==null?void 0:_.point)??0,ranking:(($=l.result.playerSouth)==null?void 0:$.ranking)??"1",ronCount:0,riichiCount:0,chuckCount:0,scores:[25e3]},playerWest:{score:((D=l.result.playerWest)==null?void 0:D.score)??25e3,point:((T=l.result.playerWest)==null?void 0:T.point)??0,ranking:((L=l.result.playerWest)==null?void 0:L.ranking)??"1",ronCount:0,riichiCount:0,chuckCount:0,scores:[25e3]},playerNorth:{score:((q=l.result.playerNorth)==null?void 0:q.score)??25e3,point:((z=l.result.playerNorth)==null?void 0:z.point)??0,ranking:((B=l.result.playerNorth)==null?void 0:B.ranking)??"1",ronCount:0,riichiCount:0,chuckCount:0,scores:[25e3]}};for(const s of l.rounds)o.playerEast.scores.push(s.playerEast.afterScore),o.playerSouth.scores.push(s.playerSouth.afterScore),o.playerWest.scores.push(s.playerWest.afterScore),o.playerNorth.scores.push(s.playerNorth.afterScore),s.playerEast.status==="isRiichied"&&(o.playerEast.riichiCount+=1),s.playerSouth.status==="isRiichied"&&(o.playerSouth.riichiCount+=1),s.playerWest.status==="isRiichied"&&(o.playerWest.riichiCount+=1),s.playerNorth.status==="isRiichied"&&(o.playerNorth.riichiCount+=1),(s.type==="ron"||s.type==="tsumo")&&(s.playerEast.type==="win"&&(o.playerEast.ronCount+=1),s.playerSouth.type==="win"&&(o.playerSouth.ronCount+=1),s.playerWest.type==="win"&&(o.playerWest.ronCount+=1),s.playerNorth.type==="win"&&(o.playerNorth.ronCount+=1)),s.type==="ron"&&(s.playerEast.type==="lose"&&(o.playerEast.chuckCount+=1),s.playerSouth.type==="lose"&&(o.playerSouth.chuckCount+=1),s.playerWest.type==="lose"&&(o.playerWest.chuckCount+=1),s.playerNorth.type==="lose"&&(o.playerNorth.chuckCount+=1));const P=[{player:t.players[0],result:o.playerEast},{player:t.players[1],result:o.playerSouth},{player:t.players[2],result:o.playerWest},{player:t.players[3],result:o.playerNorth}].sort((s,d)=>d.result.score-s.result.score);c.push({type:"players",_id:"players",teamAndPlayers:P,roundCount:((G=l.rounds)==null?void 0:G.filter(s=>s.type!=="hotfix").length)??0,exhaustedRoundCount:((U=l.rounds)==null?void 0:U.filter(s=>s.type==="exhausted").length)??0,subslide:1});const V=l.rounds.findIndex(s=>s.code.startsWith("5."));c.push({type:"chart",_id:"chart",rounds:[{name:"東",playerEast:25e3,playerSouth:25e3,playerWest:25e3,playerNorth:25e3},...l.rounds.map((s,d)=>({name:d===V?"南":"",playerEast:s.playerEast.afterScore,playerSouth:s.playerSouth.afterScore,playerWest:s.playerWest.afterScore,playerNorth:s.playerNorth.afterScore}))],players:{playerEast:{name:t.players[0].primaryName,color:p[(parseInt(o.playerEast.ranking)??1)-1].strokeColor,strokeColor:p[(parseInt(o.playerEast.ranking)??1)-1].color},playerSouth:{name:t.players[1].primaryName,color:p[(parseInt(o.playerSouth.ranking)??1)-1].strokeColor,strokeColor:p[(parseInt(o.playerSouth.ranking)??1)-1].color},playerWest:{name:t.players[2].primaryName,color:p[(parseInt(o.playerWest.ranking)??1)-1].strokeColor,strokeColor:p[(parseInt(o.playerWest.ranking)??1)-1].color},playerNorth:{name:t.players[3].primaryName,color:p[(parseInt(o.playerNorth.ranking)??1)-1].strokeColor,strokeColor:p[(parseInt(o.playerNorth.ranking)??1)-1].color}},teamAndPlayers:P,subslide:1});const Z=["playerEast","playerSouth","playerWest","playerNorth"];if(v&&n){const s=v.players.map(d=>{var u;return{player:d,point:((u=d.statistics)==null?void 0:u.point)??0,active:!1}});for(let d=0;d<4;d++){const u=s.find(ee=>ee.player.id===n.data.players[d].id);u&&(u.point+=o[Z[d]].point,u.active=!0)}c.push({type:"grand-ranking",_id:"grand-ranking",players:s.toSorted((d,u)=>(u.point??0)-(d.point??0)),subslide:1})}return c},[v,n,t,i]),[S,f]=y.useState(0),[W,N]=y.useState(0),[E,j]=y.useState(!1),[A,J]=y.useState(a??0),[w,O]=y.useState(m??0),g=y.useCallback(()=>{if(E)return;const l=C[S];if(!l){f(1);return}l.type==="empty"?f(c=>c+1):W>=l.subslide-1?(f(c=>c+.5),j(!0),setTimeout(()=>{f(c=>Math.ceil(c)),N(0),j(!1)},1200)):(N(c=>c+.5),j(!0),setTimeout(()=>{N(c=>Math.ceil(c)),j(!1)},1200))},[E,S,C,W]),Q=y.useCallback(()=>{g()},[g]);return y.useEffect(()=>{typeof a<"u"&&a!==A&&(g(),J(a))},[a,g,A]),y.useEffect(()=>{typeof m<"u"&&m!==w&&(f(0),N(0),O(m))},[a,g,A,w,m]),!t||!i||!n?e.jsx(e.Fragment,{}):e.jsxs("div",{className:`${H["match-introduction"]} absolute inset-0 text-[#ec276e] text-[36px]`,style:{background:"linear-gradient(to bottom, rgb(255, 217, 227), rgb(255, 192, 203)"},onClick:Q,children:[e.jsx("div",{className:"absolute inset-0",children:e.jsx("video",{src:"/videos/ptt-bg3.mp4",className:"absolute inset-0",autoPlay:!0,loop:!0,muted:!0})}),e.jsx("div",{className:"absolute py-16 px-24 inset-0",children:e.jsxs("div",{className:"flex items-start gap-x-[0.25em] mi-title-in",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"flex justify-start",children:e.jsx("div",{className:"font-bold text-[1.5em] leading-[100%]"})}),e.jsxs("div",{className:"flex gap-x-10",children:[e.jsx("div",{className:"font-bold text-[2.5em]",children:"對局結果"}),e.jsx("div",{className:"font-bold text-[2.5em]",children:"Result"})]})]}),e.jsx("div",{children:e.jsx("h1",{className:"text-[1.25em] font-semibold font-kurewa",children:n.data.name.official.primary})})]})}),C.map((l,c)=>e.jsx(me,{slide:l,status:S-c,subslide:W},l._id))]})};export{je as default};
