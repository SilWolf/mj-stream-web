import{r,z as M,j as e,c as P,d as E}from"./index-XMqLaEd9.js";import{M as T}from"./index-CzWkYpG9.js";import{M as z}from"./index-CSRoNBcQ.js";import{u as $}from"./index-gSX6M8qi.js";import{v as U,e as J,R as b}from"./mahjong.helper-czAoz2vP.js";import{M as L}from"./index-CmOKIFxO.js";import{M as k}from"./index-DKEcjmNK.js";import{a as A,M as H}from"./index-B4oswWN6.js";const y={"riichi-sakura":"_riichi-sakura_vtb0w_39","reach-animation":"_reach-animation_vtb0w_326","sakura-review-block":"_sakura-review-block_vtb0w_437"};function V(n,t=500){const[s,g]=r.useState(n);return r.useEffect(()=>{const m=setTimeout(()=>{g(n)},t);return()=>{clearTimeout(m)}},[n,t]),s}function S({score:n,scoreChanges:t=[],point:s,ranking:g,isEast:m,isRiichi:c,isFuriten:h,isYellowCarded:x,isRedCarded:p,isRonDisallowed:f,waitingTiles:l,waitingTileRemain:a,reveals:i,showPointAndRanking:d,className:R,player:o,...D}){const[N,_]=r.useState(n),[j,w]=r.useState(null),v=V(a,800),C=r.useMemo(()=>M(o.color??"#000000"),[o.color]),I=r.useMemo(()=>!!j,[j]);return r.useEffect(()=>{n!==N&&(w(t),setTimeout(()=>{_(n)},2550),setTimeout(()=>{w(null)},3e3))},[n,t,N]),e.jsxs("div",{className:"relative min-w-[5.35em] mx-auto [&_.hide-if-changing]:transition-opacity data-[score-changing='1']:[&_.hide-if-changing]:opacity-0 overflow-visible","data-score-changing":I?"1":"0",children:[e.jsxs("div",{className:"absolute top-[0.05em] bottom-[0.15em] -left-[0.1em] -right-[0.1em] rounded-[0.1em] overflow-hidden -z-50",children:[x&&e.jsx("div",{className:"absolute top-0 left-0 w-[200%] aspect-square animate-[yellowPenaltyAni_8s_ease-in-out_1]"}),p&&e.jsx("div",{className:"absolute top-0 left-0 w-[200%] aspect-square animate-[redPenaltyAni_8s_ease-in-out_1]"})]}),e.jsxs("div",{className:"relative pb-5",children:[e.jsxs("div",{className:"relative flex flex-col gap-y-[0.125em] items-end justify-end min-h-[2.8em]",children:[e.jsxs("div",{className:`${y["riichi-sakura"]} -z-1`,style:{opacity:c?1:0},children:[e.jsx("img",{className:"riichi-sakura-large",src:"/images/riichi-sakura.png"}),e.jsx("img",{className:"riichi-sakura-single top-0 right-0 h-4 w-4",src:"/images/riichi-sakura-single.png",style:{animationDelay:"3s"}}),e.jsx("img",{className:"riichi-sakura-single top-4 right-1/2 h-6 w-6",src:"/images/riichi-sakura-single.png",style:{animationDelay:"5s"}}),e.jsx("img",{className:"riichi-sakura-single top-10 right-1/3 h-8 w-8",src:"/images/riichi-sakura-single.png",style:{animationDelay:"2s"}}),e.jsx("img",{className:"riichi-sakura-single top-16 right-[60%] h-4 w-4",src:"/images/riichi-sakura-single.png",style:{animationDelay:"9s"}}),e.jsx("img",{className:"riichi-sakura-single top-28 right-[30%] w-18",src:"/images/score-thousand-sakura.png",style:{animationDelay:"8s"}})]}),o.propicUrl&&e.jsx("img",{className:"absolute bottom-0 left-[.125em] z-10 w-[2em] rounded-[0.08em]",src:o.propicUrl,alt:o.primaryName}),e.jsx("div",{className:"absolute bottom-full left-0 right-0",children:e.jsx("div",{className:"relative bg-black/50 rounded-[.125em] opacity-0 transition-opacity data-[has-reveals=true]:opacity-100 hide-if-changing overflow-visible origin-left",style:{transform:i&&i.length>0?"scale(100%, 100%)":"scale(0, 100%)",transition:"transform 1s"},"data-has-reveals":i&&i.length>0,children:e.jsx("div",{className:"flex flex-row-reverse items-end justify-end flex-wrap text-[0.28em] gap-x-2 p-2",children:i==null?void 0:i.map((u,F)=>e.jsx("div",{className:y["sakura-review-block"],children:e.jsx("div",{children:e.jsx(A,{value:u})})},F))})})}),e.jsx("div",{className:"pl-[2.4em] pt-[0.125em] w-full gap-[0.125em] relative",children:e.jsxs("div",{className:"relative hide-if-changing",children:[e.jsxs("div",{className:"relative rounded-[.125em] bg-black/50 data-[furiten=true]:bg-red-500/25 overflow-hidden origin-left",style:{transform:l&&l.length>0?"scale(100%, 100%)":"scale(0, 100%)",opacity:l&&l.length>0?1:0,transition:"transform 1s, opacity 1s, background-color 1s"},"data-has-waiting-tiles":l&&l.length>0,"data-furiten":h,children:[e.jsxs("div",{className:"text-center text-[0.25em] bg-red-800/50 overflow-hidden h-0 data-[furiten=true]:h-[1.5em] transition-[height] duration-1000","data-furiten":h,children:[e.jsx("i",{className:"bi bi-exclamation-diamond"})," 振聽"]}),e.jsxs("div",{className:"text-[0.5em] flex gap-x-[0.2em] p-[0.2em] pl-[0.2em] pr-[0.2em]",children:[e.jsx("div",{className:"text-[#FFFFFF] w-[2em] text-[0.4em] leading-[1.3em] flex items-center justify-center",children:typeof v=="number"?e.jsx("div",{className:"text-center",children:e.jsx("p",{className:"pt-[0.1em] font-numeric",style:{fontSize:v>9?"1.8em":"2.2em",opacity:v===0?.5:1},children:v})}):e.jsxs(e.Fragment,{children:["待",e.jsx("br",{}),"牌"]})}),e.jsx("div",{className:"flex-1 leading-none flex flex-wrap gap-[0.18em] text-[0.85em]",children:l==null?void 0:l.map(u=>e.jsx("div",{className:"animate-[fadeInFromLeft_1s_ease-in-out]",children:e.jsx(H,{value:u})},u))})]})]}),e.jsxs("div",{className:"absolute rounded-[.125em] bg-red-600/75 inset-0 flex gap-x-2 items-center justify-center opacity-0 transition-opacity duration-500 hide-if-changing cursor-pointer text-[0.3em]",style:{opacity:f?1:0},children:[e.jsx("i",{className:"bi bi-ban"})," 和了禁止"]})]})}),e.jsxs("div",{className:"relative self-stretch text-right ml-[6em] text-[0.4em] mr-[0.1em] leading-none text-white hide-if-changing font-semibold whitespace-nowrap",children:[e.jsxs("div",{className:"absolute z-20 top-0 left-0 bottom-0 flex gap-x-1",children:[x&&e.jsx("div",{className:"h-[1em] w-[0.75em] bg-[#ffe100] rounded-[0.05em]"}),p&&e.jsx("div",{className:"h-[1em] w-[0.75em] bg-[#ff1900] rounded-[0.05em]"})]}),o.primaryName]}),e.jsxs("div",{className:`relative w-full text-right bg-white px-[0.1em] pb-[0.05em] ${R}`,...D,style:{background:`linear-gradient(260deg, ${C}, ${o.color}`},children:[j&&e.jsx("div",{className:"absolute bottom-[1.75em] pr-[0.125em] right-0 text-[0.5625em] leading-none animate-[drop_3s_ease-in-out] font-numeric",children:j.map(u=>e.jsx("div",{children:e.jsx(k,{signed:!0,value:u,positiveClassName:"text-[#09eb09]",negativeClassName:"text-[#eb0000]"})}))}),e.jsxs("div",{className:`${y["riichi-sakura"]} z-1`,style:{opacity:c?1:0},children:[e.jsx("img",{className:"riichi-sakura-single top-0 right-0 h-8 w-8 brightness-200",src:"/images/riichi-sakura-single.png",style:{animationDelay:"3s"}}),e.jsx("img",{className:"riichi-sakura-single top-4 right-1/2 h-12 w-12 brightness-200",src:"/images/riichi-sakura-single.png",style:{animationDelay:"5s"}}),e.jsx("img",{className:"riichi-sakura-single top-10 right-1/3 h-6 w-6 brightness-200",src:"/images/riichi-sakura-single.png",style:{animationDelay:"2s"}}),e.jsx("img",{className:"riichi-sakura-single top-16 right-[60%] h-8 w-8 brightness-200",src:"/images/riichi-sakura-single.png",style:{animationDelay:"9s"}}),e.jsx("img",{className:"riichi-sakura-single top-8 right-1/2 w-36 brightness-200",src:"/images/score-thousand-sakura.png",style:{animationDelay:"5s"}})]}),e.jsxs("div",{className:"relative mt-[0.12em] mb-[0.03em] z-10",children:[e.jsx("p",{className:"relative text-[0.6em] flex-1 leading-none text-white font-numeric",style:{transition:"opacity 1s, bottom 1s",opacity:d?0:1,bottom:d?"1em":0},children:e.jsx(k,{animated:!0,value:N})}),e.jsxs("p",{className:"absolute right-[0.25em] text-[0.6em] flex-1 leading-none text-white font-numeric space-x-4",style:{transition:"opacity 1s, bottom 1s",opacity:d?1:0,bottom:d?0:"-1em"},children:[e.jsxs("span",{className:"text-[0.8em]",children:[P(s),"pt"]}),e.jsx("span",{className:"text-[0.75em]",children:E(g)})]})]})]})]}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 h-2 bg-error rounded-full transition-[left,right]",style:{left:m?"0%":"100%",right:m?"0%":"100%"}})]})]})}function q({active:n,color:t="#000000",largeLogoUrl:s}){return e.jsxs(e.Fragment,{children:[e.jsx("img",{src:"/images/r.png",className:"w-0 h-0 opacity-0"}),e.jsx("img",{src:"/images/e.png",className:"w-0 h-0 opacity-0"}),e.jsx("img",{src:"/images/a.png",className:"w-0 h-0 opacity-0"}),e.jsx("img",{src:"/images/c.png",className:"w-0 h-0 opacity-0"}),e.jsx("img",{src:"/images/h.png",className:"w-0 h-0 opacity-0"}),e.jsx("img",{src:"/images/score-thousand.png",className:"w-0 h-0 opacity-0"}),n&&e.jsxs("div",{className:y["reach-animation"],children:[e.jsx("div",{className:"reach-background",style:{background:`linear-gradient(to bottom, transparent, ${t}80 40%, ${t}80 60%, transparent)`}}),e.jsx("div",{className:"reach-animation-logo",style:{backgroundImage:`url("${s}")`}}),e.jsx("div",{className:"reach-animation-bar",style:{backgroundImage:'url("/images/score-thousand.png")'}}),e.jsxs("div",{className:"reach-animation-text",children:[e.jsx("div",{className:"reach-animation-text-character c1",style:{backgroundImage:'url("/images/r.png")'}}),e.jsx("div",{className:"reach-animation-text-character c2",style:{backgroundImage:'url("/images/e.png")'}}),e.jsx("div",{className:"reach-animation-text-character c3",style:{backgroundImage:'url("/images/a.png")'}}),e.jsx("div",{className:"reach-animation-text-character c4",style:{backgroundImage:'url("/images/c.png")'}}),e.jsx("div",{className:"reach-animation-text-character c5",style:{backgroundImage:'url("/images/h.png")'}})]})]})]})}function Z({params:{matchId:n}}){const{rtMatch:t,rtMatchCurrentRound:s,rtMatchCurrentRoundDoras:g}=$(n),m=r.useMemo(()=>{if(!t||!s)return[];const a=U([s.playerResults[0].afterScore,s.playerResults[1].afterScore,s.playerResults[2].afterScore,s.playerResults[3].afterScore]);return["0","1","2","3"].map((i,d)=>({...t.players[i],color:t.players[i].color,currentStatus:{...s.playerResults[i],isEast:J(i,s.roundCount),...a[d]}}))},[t,s]),[c,h]=r.useState(null),[x,p]=r.useState(),[f,l]=r.useState({0:!1,1:!1,2:!1,3:!1});return r.useEffect(()=>{["0","1","2","3"].forEach(a=>{typeof(s==null?void 0:s.playerResults[a].isRiichi)<"u"&&s.playerResults[a].isRiichi!==f[a]&&(s.playerResults[a].isRiichi===!0&&(h(a),setTimeout(()=>{h(null)},2800)),l(i=>({...i,[a]:s.playerResults[a].isRiichi})))})},[s==null?void 0:s.playerResults,f]),r.useEffect(()=>{x!==(s==null?void 0:s.code)&&(p(s==null?void 0:s.code),l({0:!1,1:!1,2:!1,3:!1}))},[s==null?void 0:s.code,x]),!t||!s?e.jsx("div",{className:"text-current",children:"對局讀取失敗。"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"absolute -z-10 inset-0 mx-auto py-8 overflow-hidden text-[4.8rem] transition-opacity",style:{background:"linear-gradient(transparent, transparent 73%, rgba(0, 0, 0, 0.8))",opacity:c!==null?0:1},children:[e.jsxs("div",{className:"absolute top-[1vh] right-[1vw] w-[20vw]",children:[e.jsx("img",{src:"/images/logo-sakura-long.png",className:"opacity-0",alt:""}),e.jsx("div",{className:"text-right text-[0.5em] pr-[0.5em] relative bottom-[0.5em] text-[#ec276e] font-numeric",children:t.nameDisplay||t.name})]}),e.jsxs("div",{className:"flex flex-row items-stretch gap-x-4 text-white",children:[e.jsxs("div",{className:"relative text-[0.6em] p-2 pl-10 pr-[1em] flex items-center gap-x-8",style:{transition:"width 0.3s, left 1.5s, opacity 1.5s",left:t.hideHeader?"-100%":"0",opacity:t.hideHeader?"0":"1",background:"linear-gradient(280deg, transparent, transparent 0.5em, #00000080 0.5em, #00000080 100%)"},children:[e.jsx("div",{className:"",children:e.jsxs("div",{className:"flex gap-x-2 items-center h-[2em]",children:[e.jsx("div",{className:"min-w-[3.5em]",children:e.jsx(T,{roundCount:s.roundCount,max:8})}),e.jsxs("div",{className:"flex flex-col justify-around gap-2",children:[e.jsxs("div",{className:"flex-1 flex flex-row items-center gap-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("img",{src:"/images/score-hundred.png",alt:"hundred",className:"h-[0.25em] mt-[0.1em]"})}),e.jsx("div",{className:"text-[0.45em] leading-none",children:s.extendedRoundCount??0})]}),e.jsxs("div",{className:"flex-1 flex flex-row items-center gap-x-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("img",{src:"/images/score-thousand.png",alt:"thousand",className:"h-[0.25em] mt-[0.1em]"})}),e.jsx("div",{className:"text-[0.45em] leading-none",children:s.cumulatedThousands??0})]})]})]})}),e.jsx("div",{className:"flex items-center gap-x-2",children:g.map(a=>e.jsx(z,{className:"w-[1.4em]! animate-[fadeInFromLeft_0.5s_ease-in-out]",children:a},a))})]}),e.jsx("div",{className:"flex-1 flex items-start justify-end text-black pr-10 self-start"})]}),e.jsx("div",{className:"flex items-center justify-center mt-20",children:e.jsx("div",{className:"body-hidden mx-20 text-[16px]"})}),e.jsx("div",{className:"absolute bottom-0 left-0 right-0 px-10 pb-6 grid grid-cols-4 items-end gap-x-8 text-white animate-[fadeInFromBottom_1s_ease-in-out]",style:{opacity:t.activeResultDetail||t.hidePlayers?0:1,bottom:t.activeResultDetail||t.hidePlayers?"-150px":0,transition:"opacity 0.5s, bottom 0.5s"},children:m.map(a=>e.jsxs("div",{className:"w-full",children:[e.jsx(S,{player:a,score:a.currentStatus.afterScore,scoreChanges:a.currentStatus.scoreChanges,isEast:a.currentStatus.isEast,isRiichi:a.currentStatus.isRiichi&&s.resultType===b.Unknown,isFuriten:a.currentStatus.isFuriten,waitingTiles:s.resultType===b.Unknown?a.currentStatus.waitingTiles:[],waitingTileRemain:a.currentStatus.waitingTileRemain,reveals:s.resultType===b.Unknown?a.currentStatus.reveals:[],isYellowCarded:a.currentStatus.isYellowCarded,isRedCarded:a.currentStatus.isRedCarded,isRonDisallowed:a.currentStatus.isRonDisallowed,ranking:a.currentStatus.ranking,point:a.currentStatus.point,showPointAndRanking:!!t.showPoints}),e.jsx("img",{src:a.largeLogoUrl,className:"w-0 h-0"})]},a.primaryName))}),t.activeResultDetail&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 px-10 pb-6 grid grid-cols-4 items-end gap-x-8 text-white transition-opacity animate-[fadeInFromBottom_1s_ease-in-out]",children:[e.jsx("div",{className:"w-full",children:e.jsx(S,{player:t.players[t.activeResultDetail.winnerPlayerIndex],score:s.playerResults[t.activeResultDetail.winnerPlayerIndex].afterScore})}),e.jsxs("div",{className:"col-span-3 mb-5 bg-black/50 py-6 px-8 text-[0.5em] min-h-[5.5em] flex items-stretch gap-x-4",children:[e.jsx("div",{className:`flex-1 flex flex-wrap gap-x-[0.75em] ${t.activeResultDetail.yakumanCount>0?"self-center justify-center":""}`,children:t.activeResultDetail.yakus.map(({label:a})=>e.jsx("span",{children:a},a))}),e.jsx("div",{className:"shrink-0 w-px bg-neutral-200"}),e.jsx("div",{className:"shrink-0 min-w-[3em] self-center text-green-400 text-[1.4em] text-center",children:e.jsx(L,{han:t.activeResultDetail.han,fu:t.activeResultDetail.fu,yakumanCount:t.activeResultDetail.yakumanCount})})]})]})]}),e.jsx("div",{className:"absolute top-0 bottom-0 left-0 right-0 pointer-events-none",children:e.jsx(q,{active:c!==null,color:c&&m[c].color,largeLogoUrl:c&&m[c].largeLogoUrl})})]})}export{Z as default};
