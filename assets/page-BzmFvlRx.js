import{r as m,j as e,u as V,d as L,c as P}from"./index-BMGwXdKL.js";import{R as O,L as W,C as G,X as H,Y as U,a as q}from"./LineChart-CSwIzkhA.js";import{a as X}from"./sanity.helper-DUp38FlF.js";import{u as D}from"./useSearchParam-drbZCacZ.js";import"./tiny-invariant-BaFNuDhB.js";import"./util-CeAI_f06.js";var Y=function(s,l){var n=m.useRef(function(){});m.useEffect(function(){n.current=s}),m.useEffect(function(){if(l!==null){var t=setInterval(function(){return n.current()},l||0);return function(){return clearInterval(t)}}},[l])};const J=({m:s})=>{const[l,n]=m.useState(s*60),[t,i]=m.useMemo(()=>[Math.floor(l/60).toString().padStart(2,"0"),(l%60).toString().padStart(2,"0")],[l]);return m.useEffect(()=>{n(s*60)},[s]),Y(()=>{n(a=>a-1)},l>0?1e3:null),l<=0?e.jsx("span",{children:"--:--"}):e.jsxs("span",{children:[t,":",i]})};function Q({teamAndStatistics:s}){const l=m.useMemo(()=>{const n=Math.max(...s.map(({statistics:i})=>i.matchCount)),t=Array(n+1).fill(void 0).map((i,a)=>({name:a%2===1?`W${Math.ceil(a/2)}`:""}));for(const i of s)for(let a=0;a<n;a++)t[a][i.team._id]=i.statistics.pointHistories[a];return t},[s]);return e.jsx(O,{width:"100%",height:"100%",children:e.jsxs(W,{data:l,children:[e.jsx(G,{strokeDasharray:"3 3"}),e.jsx(H,{tick:{fill:"white"},dataKey:"name"}),e.jsx(U,{tick:{fill:"white"},width:80,allowDecimals:!1,tickCount:5}),s.map(n=>e.jsx(q,{type:"linear",stroke:"#FFF",strokeWidth:10,isAnimationActive:!1,dataKey:n.team._id},n.team._id)),s.map(n=>e.jsx(q,{type:"linear",stroke:n.team.color,strokeWidth:8,isAnimationActive:!1,name:n.team.name,dataKey:n.team._id},n.team._id))]})})}const E="62e7d07d-f59f-421d-a000-2e4d28ab89db",y=(s,l,n,t,i)=>s.map(a=>({teamAndPlayer:a,value:l(a.player.statistics),tieBreakValue:n(a.player.statistics)})).sort((a,x)=>a.value===x.value?(a.tieBreakValue-x.tieBreakValue)*(i==="asc"?1:-1):(a.value-x.value)*(t==="asc"?1:-1)).slice(0,6),Z=({slide:s,status:l,subslide:n})=>s.type==="teams"?e.jsxs("div",{className:"absolute inset-0 flex flex-col twr-team-ranking","data-active":l===0,style:{opacity:l>=0&&l<1?1:0},children:[e.jsxs("div",{className:"grid grid-flow-col grid-rows-1 gap-x-8 twr-team-ranking-row",children:[e.jsxs("div",{className:"flex-1 flex items-center text-[0.75em]",children:[e.jsx("p",{className:"flex-1 text-center",children:"排名"}),e.jsx("p",{className:"flex-[2.5]",children:"隊伍"}),e.jsx("p",{className:"flex-1 text-right",children:"積分"}),e.jsx("p",{className:"flex-1 text-right",children:"差距"}),e.jsx("p",{className:"flex-1 text-right",children:"半莊數"})]}),e.jsxs("div",{className:"flex-1 flex items-center text-[0.75em]",children:[e.jsx("p",{className:"flex-1 text-center",children:"排名"}),e.jsx("p",{className:"flex-[2.5]",children:"隊伍"}),e.jsx("p",{className:"flex-1 text-right",children:"積分"}),e.jsx("p",{className:"flex-1 text-right",children:"差距"}),e.jsx("p",{className:"flex-1 text-right",children:"半莊數"})]})]}),e.jsx("div",{className:"flex-1 grid grid-cols-2 gap-x-8 h-full",children:[0,8,1,9,2,10,3,11,4,12,5,13,6,14,7,15].map(t=>e.jsxs("div",{className:"relative flex-1 flex items-center overflow-hidden twr-team-ranking-row",style:{background:`linear-gradient(to right, ${s.teams[t].team.color}C0, transparent 105%)`,animationDelay:`${t*.05}s`},children:[e.jsx("img",{src:s.teams[t].team.squareLogoImage+"?w=320&h=320",alt:s.teams[t].team._id,className:"absolute left-48 opacity-10 -z-10"}),e.jsx("p",{className:"flex-1 text-center space-x-2",children:e.jsx("span",{children:L(s.teams[t].statistics.ranking)})}),e.jsxs("div",{className:"flex-[2.5]",children:[e.jsx("p",{children:s.teams[t].team.name}),e.jsx("p",{className:"text-[24px] leading-[24px]",children:s.teams[t].team.secondaryName})]}),e.jsx("p",{className:"flex-1 text-right",children:P(s.teams[t].statistics.point)}),e.jsx("p",{className:"flex-1 text-right",children:t>0?(s.teams[t-1].statistics.point-s.teams[t].statistics.point).toFixed(1):"-"}),e.jsxs("p",{className:"flex-1 text-right",children:[s.teams[t].statistics.matchCount,e.jsx("span",{className:"text-[0.75em]",children:"/60"})]})]},t))})]}):s.type==="chart"?e.jsxs("div",{className:"absolute inset-0 flex twr-chart gap-[1em] items-stretch","data-active":l===0,style:{opacity:l>=0&&l<1?1:0},children:[e.jsx("div",{className:"flex-3 twr-chart-chart",children:e.jsx(Q,{teamAndStatistics:s.teams})}),e.jsx("div",{className:"flex-1 flex flex-col twr-team-ranking","data-active":l===0,children:s.teams.map((t,i)=>e.jsxs("div",{className:"relative flex-1 flex items-center justify-between overflow-hidden twr-team-ranking-row px-2",style:{background:`linear-gradient(to right, ${t.team.color}C0, transparent 105%)`,animationDelay:`${i*.05}s`},children:[e.jsx("img",{src:t.team.squareLogoImage+"?w=320&h=320",alt:t.team._id,className:"absolute left-0 opacity-5 -z-10"}),e.jsx("div",{children:e.jsx("p",{children:t.team.name})}),e.jsx("div",{children:P(t.statistics.point)})]},t.team._id))})]}):s.type==="players"?e.jsxs("div",{className:"absolute inset-0 flex twr-player-ranking gap-[1em] items-stretch twr-player-ranking","data-active":l===0,style:{opacity:l>=0&&l<1?1:0},children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-y-[.5em]",children:[e.jsx("h4",{className:"text-[2em] font-semibold text-center leading-[1em] twr-player-ranking-row",children:"MVP"}),e.jsx("p",{className:"text-center twr-player-ranking-row",children:"積分最高選手"}),e.jsx("div",{className:"flex-1 flex flex-col",children:s.highestPointPlayers.map(({teamAndPlayer:{team:t,player:i},value:a,tieBreakValue:x},h)=>e.jsxs("div",{className:"relative overflow-hidden flex-1 flex flex-col items-stretch justify-center twr-player-ranking-row",style:{background:`linear-gradient(to right, ${t.color}C0, transparent 105%)`,animationDelay:`${h*.05}s`},children:[e.jsx("img",{src:t.squareLogoImage+"?w=320&h=320",alt:t.name,className:"absolute left-[3em] opacity-25 -z-10"}),e.jsxs("div",{className:"flex items-center justify-between px-[.5em] gap-x-[.5em]",children:[e.jsx("div",{className:"w-[2.2em]",children:L(h+1)}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-[1.5em] leading-[1em]",children:i.nickname}),e.jsx("p",{className:"text-[.75em] leading-[1em]",children:i.name})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("p",{className:"text-[1.5em] leading-[1em] font-numeric",children:a.toFixed(1)}),e.jsxs("p",{className:"text-[.75em] leading-[1em] opacity-80",children:["(半莊數: ",x,")"]})]})]})]},i._id))})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-[1em] twr-player-ranking-row",children:[e.jsxs("div",{className:"space-y-[.5em]",children:[e.jsx("p",{className:"text-center",children:"和了率"}),e.jsx("div",{className:"flex-1 flex flex-col",children:s.highestRonPPlayers.map(({teamAndPlayer:{team:t,player:i},value:a})=>e.jsxs("div",{className:"relative overflow-hidden flex-1 flex flex-col items-stretch justify-center",style:{background:`${t.color}20`},children:[e.jsx("img",{src:t.squareLogoImage+"?w=320&h=320",alt:t.name,className:"absolute left-[3em] opacity-5 -z-10"}),e.jsxs("div",{className:"flex items-center justify-between px-[.5em] gap-x-[.5em] py-[.25em]",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"leading-[1.2em]",children:i.nickname})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"leading-[1.2em]",children:a.toFixed(2)})})]})]},i._id))})]}),e.jsxs("div",{className:"space-y-[.5em]",children:[e.jsx("p",{className:"text-center",children:"平均打點"}),e.jsx("div",{className:"flex-1 flex flex-col",children:s.highestRonPurePointPlayers.map(({teamAndPlayer:{team:t,player:i},value:a})=>e.jsxs("div",{className:"relative overflow-hidden flex-1 flex flex-col items-stretch justify-center",style:{background:`${t.color}20`},children:[e.jsx("img",{src:t.squareLogoImage+"?w=320&h=320",alt:t.name,className:"absolute left-[3em] opacity-5 -z-10"}),e.jsxs("div",{className:"flex items-center justify-between px-[.5em] gap-x-[.5em] py-[.25em]",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"leading-[1.2em]",children:i.nickname})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"leading-[1.2em]",children:a.toFixed(2)})})]})]},i._id))})]}),e.jsxs("div",{className:"space-y-[.5em]",children:[e.jsx("p",{className:"text-center",children:"銃和率"}),e.jsx("div",{className:"flex-1 flex flex-col",children:s.lowestChuckPPlayers.map(({teamAndPlayer:{team:t,player:i},value:a})=>e.jsxs("div",{className:"relative overflow-hidden flex-1 flex flex-col items-stretch justify-center",style:{background:`${t.color}20`},children:[e.jsx("img",{src:t.squareLogoImage+"?w=320&h=320",alt:t.name,className:"absolute left-[3em] opacity-5 -z-10"}),e.jsxs("div",{className:"flex items-center justify-between px-[.5em] gap-x-[.5em] py-[.25em]",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"leading-[1.2em]",children:i.nickname})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"leading-[1.2em]",children:a.toFixed(2)})})]})]},i._id))})]}),e.jsxs("div",{className:"space-y-[.5em]",children:[e.jsx("p",{className:"text-center",children:"最高得點"}),e.jsx("div",{className:"flex-1 flex flex-col",children:s.highestScoreMax.map(({teamAndPlayer:{team:t,player:i},value:a})=>e.jsxs("div",{className:"relative overflow-hidden flex-1 flex flex-col items-stretch justify-center",style:{background:`${t.color}20`},children:[e.jsx("img",{src:t.squareLogoImage+"?w=320&h=320",alt:t.name,className:"absolute left-[3em] opacity-5 -z-10"}),e.jsxs("div",{className:"flex items-center justify-between px-[.5em] gap-x-[.5em] py-[.25em]",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"leading-[1.2em]",children:i.nickname})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"leading-[1.2em]",children:a.toFixed(0)})})]})]},i._id))})]})]})]}):s.type==="heatmap"?e.jsx("div",{className:"absolute inset-0 flex gap-[1em] items-stretch twr-heatmap","data-active":l===0,style:{opacity:l>=0&&l<1?1:0},children:e.jsxs("div",{className:"flex-1 flex flex-col gap-y-[.5em]",children:[e.jsx("h4",{className:"text-[2em] font-semibold text-center leading-[1em] twr-heatmap-title",children:"點數熱力圖"}),e.jsxs("p",{className:"text-center mb-8 twr-heatmap-title",children:[e.jsx("span",{className:"bg-green-500 px-1",children:"綠色"}),"代表高分、",e.jsx("span",{className:"bg-red-500 px-1",children:"紅色"}),"代表低分"]}),e.jsxs("div",{className:"grid flex-1 text-center text-[.65em]",style:{gridTemplateColumns:`repeat(${s.teams.length}, minmax(0, 1fr))`},children:[s.teams.map(({team:t,statistics:i},a)=>e.jsxs("div",{className:"twr-heatmap-cell h-10",style:{animationDelay:a*.05+"s"},children:[e.jsx("div",{style:{background:`${t.color}80`},children:e.jsx("img",{src:t.squareLogoImage+"?w=128&h=128",alt:t.name,className:"h-24 w-24 my-2 inline-block"})}),e.jsx("p",{className:"py-2",style:{background:i.point>0?`rgba(23, 235, 0, ${i.point/s.highestTeamPoint})`:`rgba(235, 0, 0, ${i.point/s.lowestTeamPoint})`},children:P(i.point)})]},t._id)),[0,1,2,3].map(t=>s.teams.map(({team:i,players:a},x)=>{var h,o;return e.jsx("div",{className:"content-center twr-heatmap-cell",style:{background:typeof((h=a[t].statistics)==null?void 0:h.point)<"u"?a[t].statistics.point>0?`rgba(23, 235, 0, ${a[t].statistics.point/s.highestPlayerPoint})`:`rgba(235, 0, 0, ${a[t].statistics.point/s.lowestPlayerPoint})`:"tranparent",animationDelay:(x+t+1)*.05+"s"},children:P((o=a[t].statistics)==null?void 0:o.point)},i._id)}))]})]})}):e.jsx(e.Fragment,{}),re=({forwardFlag:s,refetchFlag:l,resetFlag:n,disableClick:t,auto:i,minute:a})=>{const x=D("m")||(a==null?void 0:a.toString()),h=D("auto")||i,{data:o,refetch:T}=V({queryKey:["tournament",E],queryFn:()=>X(E).then(d=>({...d,teams:d.teams.sort((c,f)=>f.statistics.point-c.statistics.point).map(({players:c,...f})=>({...f,players:c.sort((w,b)=>{var g,r;return(((g=b.statistics)==null?void 0:g.point)??0)-(((r=w.statistics)==null?void 0:r.point)??0)})}))})),enabled:!0,staleTime:5*60*1e3}),[k,u]=m.useState(0),[C,v]=m.useState(0),[$,N]=m.useState(!1),[S,z]=m.useState(s??0),[M,F]=m.useState(l??0),[_,B]=m.useState(n??0),j=m.useMemo(()=>{var b,g;if(!o)return[{type:"empty",_id:"empty",subslide:0}];const c=o.teams.map(r=>r.players.map(I=>({team:r.team,player:I})).flat()).flat().filter(({player:r})=>r.statistics.matchCount>0),f=c.sort((r,I)=>{var R,A;return(((R=I.player.statistics)==null?void 0:R.point)??0)-(((A=r.player.statistics)==null?void 0:A.point)??0)}),w=[{type:"teams",_id:"teams",teams:o.teams,subslide:1},{type:"chart",_id:"chart",teams:o.teams,subslide:1},{type:"players",_id:"players",highestPointPlayers:y(c,r=>r.point,r=>r.matchCount,"desc","asc"),highestRonPPlayers:y(c,r=>r.ronCount/r.roundCount,r=>r.roundCount,"desc","desc"),highestRonPurePointPlayers:y(c,r=>r.ronPureScoreAvg,r=>r.roundCount,"desc","desc"),lowestChuckPPlayers:y(c,r=>r.chuckCount/r.roundCount,r=>r.roundCount,"asc","desc"),highestScoreMax:y(c,r=>r.scoreMax,r=>r.roundCount,"desc","desc"),subslide:1},{type:"heatmap",_id:"heatmap",teams:o.teams,highestTeamPoint:o.teams[0].statistics.point,lowestTeamPoint:o.teams.at(-1).statistics.point,highestPlayerPoint:((b=f[0].player.statistics)==null?void 0:b.point)??0,lowestPlayerPoint:((g=f.at(-1).player.statistics)==null?void 0:g.point)??0,subslide:1}];return h||w.unshift({type:"empty",_id:"empty",subslide:0}),w},[h,o]),p=m.useCallback(()=>{if($)return;const d=j[k];if(!d){u(1);return}d.type==="empty"?u(c=>c+1):C>=d.subslide-1?(u(c=>c+.5),N(!0),setTimeout(()=>{u(c=>Math.ceil(c)%j.length),v(0),N(!1)},1200)):(v(c=>c+.5),N(!0),setTimeout(()=>{v(c=>Math.ceil(c)%j.length),N(!1)},1200))},[$,k,j,C]);m.useEffect(()=>{if(h){const d=setInterval(()=>{p()},8e3);return()=>clearInterval(d)}},[h,p]);const K=m.useCallback(()=>{t||p()},[t,p]);return m.useEffect(()=>{typeof s<"u"&&s!==S&&(p(),z(s))},[s,p,S]),m.useEffect(()=>{typeof l<"u"&&l!==M&&(T(),F(l))},[M,_,l,T]),m.useEffect(()=>{typeof n<"u"&&n!==_&&(u(0),v(0),B(n))},[s,p,S,_,n]),o?e.jsx("div",{className:"absolute inset-0",style:{background:"linear-gradient(to bottom, rgb(30, 34, 59), rgb(16, 18, 33))"},onClick:K,children:e.jsxs("div",{className:"absolute inset-0 tournament-realtime-report text-white text-[36px] flex py-[1em] px-[1em] gap-x-[1em]",children:[e.jsxs("div",{className:"twr-title flex flex-col justify-start gap-[1em] items-center relative",children:[e.jsx("div",{children:e.jsx("img",{src:o.logoUrl+"?w=280&h=280&auto=format",alt:o.name,style:{width:"3.5em",height:"3.5em",marginTop:"0.15em"}})}),e.jsx("div",{className:"flex-1 flex flex-col justify-center pb-[3.5em]",children:e.jsx("p",{style:{fontSize:"3em",writingMode:"vertical-rl",textOrientation:"upright"},children:"現時數據"})}),x&&e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 bg-cyan-500 text-center font-numeric text-[1.5em] pt-[.125em]",children:[e.jsx("p",{className:"text-[.56em]",children:"下一場賽事"}),e.jsx("p",{children:e.jsx(J,{m:parseInt(x)})})]})]}),e.jsx("div",{className:"flex-1 relative",children:j.map((d,c)=>e.jsx(Z,{slide:d,status:k-c,subslide:C},d._id))})]})}):e.jsx(e.Fragment,{})};export{re as default};
