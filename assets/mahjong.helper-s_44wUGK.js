import{g as N}from"./index-BMGwXdKL.js";var f=(e=>(e[e.Unknown=0]="Unknown",e[e.Exhausted=-1]="Exhausted",e[e.Ron=1]="Ron",e[e.SelfDrawn=2]="SelfDrawn",e[e.Hotfix=-2]="Hotfix",e))(f||{}),D=(e=>(e[e.Unknown=0]="Unknown",e[e.NextRound=1]="NextRound",e[e.Extended=2]="Extended",e[e.NextRoundAndExtended=3]="NextRoundAndExtended",e[e.Hotfix=-2]="Hotfix",e[e.End=-1]="End",e))(D||{}),h=(e=>(e[e.Win=1]="Win",e[e.Lose=-1]="Lose",e[e.None=0]="None",e))(h||{}),l=(e=>(e[e.East=0]="East",e[e.South=1]="South",e[e.West=2]="West",e[e.North=3]="North",e))(l||{});const w=[l.East,l.South,l.West,l.North],S=["0","1","2","3"],A=e=>parseInt(e,10),p=(e,r)=>w[(4+A(e)-(r-1)%w.length)%w.length],v=(e,r)=>p(e,r)===l.East,I=(e,r)=>p(e,r)===l.South,O=(e,r)=>p(e,r)===l.West,F=(e,r)=>p(e,r)===l.North,j=e=>e>=1&&e<=4,q=e=>e>=5&&e<=8,z=e=>e>=9&&e<=12,J=e=>e>=13&&e<=16,g={"1h20f":{ne:200,e:400,ner:1e3,er:1500},"1h25f":{ne:200,e:400,ner:1e3,er:1500},"1h30f":{ne:300,e:500,ner:1e3,er:1500},"1h40f":{ne:400,e:700,ner:1300,er:2e3},"1h50f":{ne:400,e:800,ner:1600,er:2400},"1h60f":{ne:500,e:1e3,ner:2e3,er:2900},"1h70f":{ne:600,e:1200,ner:2300,er:3400},"1h80f":{ne:700,e:1300,ner:2600,er:3900},"1h90f":{ne:800,e:1500,ner:2900,er:4400},"1h100f":{ne:800,e:1600,ner:3200,er:4800},"1h110f":{ne:900,e:1800,ner:3600,er:5300},"2h20f":{ne:400,e:700,ner:1500,er:2100},"2h25f":{ne:400,e:800,ner:1600,er:2400},"2h30f":{ne:500,e:1e3,ner:2e3,er:2900},"2h40f":{ne:700,e:1300,ner:2600,er:3900},"2h50f":{ne:800,e:1600,ner:3200,er:4800},"2h60f":{ne:1e3,e:2e3,ner:3900,er:5800},"2h70f":{ne:1200,e:2300,ner:4500,er:6800},"2h80f":{ne:1300,e:2600,ner:5200,er:7700},"2h90f":{ne:1500,e:2900,ner:5800,er:8700},"2h100f":{ne:1600,e:3200,ner:6400,er:9600},"2h110f":{ne:1800,e:3600,ner:7100,er:10600},"3h20f":{ne:700,e:1300,ner:2600,er:3900},"3h25f":{ne:800,e:1600,ner:3200,er:4800},"3h30f":{ne:1e3,e:2e3,ner:3900,er:5800},"3h40f":{ne:1300,e:2600,ner:5200,er:7700},"3h50f":{ne:1600,e:3200,ner:6400,er:9600},"3h60f":{ne:2e3,e:3900,ner:7700,er:11600},"4h20f":{ne:1300,e:2600,ner:5200,er:7700},"4h25f":{ne:1600,e:3200,ner:6400,er:9600},"4h30f":{ne:2e3,e:3900,ner:7700,er:11600},"5h":{ne:2e3,e:4e3,ner:8e3,er:12e3},"6h":{ne:3e3,e:6e3,ner:12e3,er:18e3},"7h":{ne:3e3,e:6e3,ner:12e3,er:18e3},"8h":{ne:4e3,e:8e3,ner:16e3,er:24e3},"9h":{ne:4e3,e:8e3,ner:16e3,er:24e3},"10h":{ne:4e3,e:8e3,ner:16e3,er:24e3},"11h":{ne:6e3,e:12e3,ner:24e3,er:36e3},"12h":{ne:6e3,e:12e3,ner:24e3,er:36e3}},$=(e,r,n)=>{let s;const t=parseInt(e,10);if(Number.isNaN(t))throw new Error(`han "${e}" is NaN`);const a=parseInt(r,10);if(Number.isNaN(a))throw new Error(`fu "${r}" is NaN`);return t>=13?s=g["12h"]:t>=5?s=g[`${t}h`]:t>=4&&a>=(n!=null&&n.roundUp?30:40)||t>=3&&a>=(n!=null&&n.roundUp?60:70)?s=g["5h"]:s=g[`${t}h${a}f`],s||g["1h30f"]},Y=(e=1)=>({ne:8e3*e,e:16e3*e,ner:32e3*e,er:48e3*e}),L=(e,r,n,s,t,a)=>{const o=n>0?Y(Math.min(U((a==null?void 0:a.yakumanMax)??"130"),n)):$(e,r,a);return s?t?{win:o.er,target:o.er}:{win:o.e*3,all:o.e}:t?{win:o.ner,target:o.ner}:{win:o.e+2*o.ne,east:o.e,others:o.ne}},X=e=>e.all||e.east?f.SelfDrawn:e.target?f.Ron:f.Unknown,G=e=>S[(e-1)%S.length],x=e=>({0:{beforeScore:e[0].afterScore,afterScore:e[0].afterScore,isRevealed:!1,isRiichi:!1,isYellowCarded:e[0].isYellowCarded||!1,isRedCarded:e[0].isRedCarded||!1,type:h.None,scoreChanges:[],prevScoreChanges:e[0].scoreChanges??[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}},1:{beforeScore:e[1].afterScore,afterScore:e[1].afterScore,isRevealed:!1,isRiichi:!1,isYellowCarded:e[1].isYellowCarded||!1,isRedCarded:e[1].isRedCarded||!1,type:h.None,scoreChanges:[],prevScoreChanges:e[1].scoreChanges??[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}},2:{beforeScore:e[2].afterScore,afterScore:e[2].afterScore,isRevealed:!1,isRiichi:!1,isYellowCarded:e[2].isYellowCarded||!1,isRedCarded:e[2].isRedCarded||!1,type:h.None,scoreChanges:[],prevScoreChanges:e[2].scoreChanges??[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}},3:{beforeScore:e[3].afterScore,afterScore:e[3].afterScore,isRevealed:!1,isRiichi:!1,isYellowCarded:e[3].isYellowCarded||!1,isRedCarded:e[3].isRedCarded||!1,type:h.None,scoreChanges:[],prevScoreChanges:e[3].scoreChanges??[],detail:{han:1,fu:30,yakumanCount:0,dora:0,redDora:0,innerDora:0,yakus:[],raw:{},isRevealed:!1,isRiichied:!1}}}),K=e=>x({0:e[0],1:e[1],2:e[2],3:e[3]}),Q=(e,r,n)=>`${e}-${r}.${n}`,b={1:"東 1 局",2:"東 2 局",3:"東 3 局",4:"東 4 局",5:"南 1 局",6:"南 2 局",7:"南 3 局",8:"南 4 局",9:"西 1 局",10:"西 2 局",11:"西 3 局",12:"西 4 局",13:"北 1 局",14:"北 2 局",15:"北 3 局",16:"北 4 局"},V=(e,r,n=8)=>{try{const s=b[Math.min(e,n)];if(!s)throw new Error(`Unable to parse round=${e} in MJMatchCounterSpan`);return r&&r!==0?`${s}${r}本場`:s}catch(s){return console.error(s),`${e}.${r??0}`}},Z=e=>{switch(e){case"0":return"3";case"1":return"0";case"2":return"1";case"3":return"2"}},E=e=>{switch(e){case"0":return"1";case"1":return"2";case"2":return"3";case"3":return"0"}},T=e=>{switch(e){case"0":return"2";case"1":return"3";case"2":return"0";case"3":return"1"}},U=e=>{switch(e){case"13":return 1;case"26":return 2;case"39":return 3;case"130":return 10}},P={[f.Ron]:"ron",[f.SelfDrawn]:"tsumo",[f.Exhausted]:"exhausted",[f.Hotfix]:"hotfix",[f.Unknown]:"unknown"},_={[l.East]:"east",[l.South]:"south",[l.West]:"west",[l.North]:"north"},W={[h.None]:"none",[h.Win]:"win",[h.Lose]:"lose"},k=(e,r)=>{var n,s,t,a,o,i,c,u,R;return{position:_[p(r,e.roundCount)],type:W[e.playerResults[r].type],status:e.playerResults[r].isRiichi||(n=e.playerResults[r].detail)!=null&&n.isRiichied?"isRiichied":e.playerResults[r].isRevealed||(s=e.playerResults[r].detail)!=null&&s.isRevealed?"isRevealed":"none",isWaited:!!e.playerResults[r].waitingTiles&&e.playerResults[r].waitingTiles.length>0,beforeScore:e.playerResults[r].beforeScore,afterScore:e.playerResults[r].afterScore,dora:(t=e.playerResults[r].detail)==null?void 0:t.dora,redDora:(a=e.playerResults[r].detail)==null?void 0:a.redDora,innerDora:(o=e.playerResults[r].detail)==null?void 0:o.innerDora,han:(i=e.playerResults[r].detail)==null?void 0:i.han,fu:(c=e.playerResults[r].detail)==null?void 0:c.fu,yaku:(R=(u=e.playerResults[r].detail)==null?void 0:u.yakus)==null?void 0:R.map(({label:C})=>C).join(" "),pureScore:0}},m=e=>{const r=e.at(-1),n=H([r.playerResults[0].afterScore,r.playerResults[1].afterScore,r.playerResults[2].afterScore,r.playerResults[3].afterScore]);return{result:{playerEast:{score:r.playerResults[0].afterScore,ranking:n[0].ranking.toString(),point:n[0].point,penalty:r.playerResults[0].isRedCarded?-30:0,penaltyReason:r.playerResults[0].isRedCarded?"紅牌":""},playerSouth:{score:r.playerResults[1].afterScore,ranking:n[1].ranking.toString(),point:n[1].point,penalty:r.playerResults[1].isRedCarded?-30:0,penaltyReason:r.playerResults[1].isRedCarded?"紅牌":""},playerWest:{score:r.playerResults[2].afterScore,ranking:n[2].ranking.toString(),point:n[2].point,penalty:r.playerResults[2].isRedCarded?-30:0,penaltyReason:r.playerResults[2].isRedCarded?"紅牌":""},playerNorth:{score:r.playerResults[3].afterScore,ranking:n[3].ranking.toString(),point:n[3].point,penalty:r.playerResults[3].isRedCarded?-30:0,penaltyReason:r.playerResults[3].isRedCarded?"紅牌":""}},rounds:e.map(a=>({_key:N(),type:P[a.resultType],code:`${a.roundCount}.${a.extendedRoundCount}`,playerEast:k(a,"0"),playerSouth:k(a,"1"),playerWest:k(a,"2"),playerNorth:k(a,"3")}))}},ee=(e,r)=>{if(r===0)return[0,0,0,0];const n=e.map((t,a)=>({score:t,index:a})).sort((t,a)=>a.score-t.score),s=[0,0,0,0];return n[0].score===n[1].score?n[1].score===n[2].score?n[2].score===n[3].score?(s[n[0].index]=Math.round(r*.4),s[n[1].index]=Math.round(r*.2),s[n[2].index]=Math.round(r*.2),s[n[3].index]=Math.round(r*.2),s):(s[n[0].index]=Math.round(r*.4),s[n[1].index]=Math.round(r*.3),s[n[2].index]=Math.round(r*.3),s):(s[n[0].index]=Math.round(r/2),s[n[1].index]=Math.round(r/2),s):(s[n[0].index]=r,s)},H=(e,r=3e4,n=[50,10,-10,-30])=>{const s=e.map((i,c)=>({score:i,index:c})).sort((i,c)=>c.score-i.score),t=[{point:0,ranking:1},{point:0,ranking:1},{point:0,ranking:1},{point:0,ranking:1}];if(new Set(e).size===4)return t[s[0].index]={point:(s[0].score-r)/1e3+n[0],ranking:1},t[s[1].index]={point:(s[1].score-r)/1e3+n[1],ranking:2},t[s[2].index]={point:(s[2].score-r)/1e3+n[2],ranking:3},t[s[3].index]={point:(s[3].score-r)/1e3+n[3],ranking:4},t;const a=n.map((i,c)=>({point:i,ranking:c+1}));let o=0;for(;o<3;){let i=o;for(;i<3&&s[o].score===s[i+1].score;)i+=1;if(o!==i){const c=a.reduce((d,M,y)=>d+(y>=o&&y<=i?M.point:0),0)*10,u=i-o+1,R=Math.floor(c*(1/u)),C=Math.floor(c-(u-1)*R);a[o].point=C/10,a[o].ranking=o+1;for(let d=o+1;d<=i;d++)a[d].point=R/10,a[d].ranking=o+1}o=i+1}return t[s[0].index]={point:(s[0].score-r)/1e3+a[0].point,ranking:a[0].ranking},t[s[1].index]={point:(s[1].score-r)/1e3+a[1].point,ranking:a[1].ranking},t[s[2].index]={point:(s[2].score-r)/1e3+a[2].point,ranking:a[2].ranking},t[s[3].index]={point:(s[3].score-r)/1e3+a[3].point,ranking:a[3].ranking},t};export{D as N,l as P,f as R,Z as a,E as b,T as c,j as d,v as e,q as f,Q as g,I as h,z as i,O as j,J as k,F as l,U as m,p as n,L as o,h as p,X as q,G as r,ee as s,K as t,m as u,H as v,V as w};
