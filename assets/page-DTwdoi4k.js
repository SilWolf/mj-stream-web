import{j as e,d as v,c as N,r as x,u as E,m as F}from"./index-XMqLaEd9.js";import{u as w,a as D,g as O,r as B,b as z}from"./date.util-BlN5A3D6.js";import{u as I}from"./useSearchParam-DRXnmoN-.js";import"./util-CeAI_f06.js";const q="_screenTitle_ksx8p_1",C={screenTitle:q};function p({player:t,ranking:s}){var n,c;return e.jsxs("div",{className:"relative text-right p-4 rounded-[1em] mt-[3em] text-white flex justify-between items-center",style:{background:t.color.primary},children:[e.jsx("div",{className:"absolute left-[2.8em] bottom-0",children:e.jsx("img",{src:(n=t.image.portrait)==null?void 0:n.default.url,className:"aspect-[18/25] w-[5em]"})}),e.jsx("div",{className:"leading-[1em] text-[1.2em]",children:v(s)}),e.jsxs("div",{children:[e.jsx("div",{className:"leading-[1em]",children:t.name.display.primary}),e.jsx("div",{className:"text-[1.6em] leading-[1em]",children:N((c=t.statistics)==null?void 0:c.point)})]})]})}function M({player:t,ranking:s}){var n,c;return e.jsxs("div",{className:"relative text-right p-4 rounded-[1em]",style:{background:t.color.primary},children:[e.jsx("div",{className:"absolute -top-4 left-[4em] bottom-0 overflow-hidden",children:e.jsx("img",{src:(n=t.image.portrait)==null?void 0:n.default.url,className:"aspect-[18/25] w-[8em]"})}),e.jsxs("div",{className:"w-full h-[3em] flex items-center justify-between text-white",children:[e.jsx("div",{className:"text-left w-[6em] text-[2em]",children:v(s)}),e.jsx("div",{className:"flex-1 text-[2em] leading-[1em] text-left",children:t.name.display.primary}),e.jsx("div",{className:"text-[2em] leading-[1em]",children:N((c=t.statistics)==null?void 0:c.point)})]})]})}const G={"twr-players-ranking":"_twr-players-ranking_gokl3_1"};function H({tournamentId:t}){const{data:s}=w(t),n=x.useMemo(()=>(s==null?void 0:s.players.toSorted((c,d)=>{var r,u;return(((r=d.statistics)==null?void 0:r.point)??0)-(((u=c.statistics)==null?void 0:u.point)??0)}))??[],[s==null?void 0:s.players]);return s?e.jsxs("div",{className:`w-full h-full flex flex-col ${G["twr-players-ranking"]}`,children:[e.jsxs("div",{className:"flex gap-x-8 items-end",children:[e.jsx("div",{className:"twr-players-ranking-item flex-5",style:{"--transition-in-delay":"0s","--transition-out-delay":"0s"},children:e.jsx(p,{player:n[1],ranking:2})}),e.jsx("div",{className:"twr-players-ranking-item flex-6 text-[1.2em]",style:{"--transition-in-delay":"0s","--transition-out-delay":"0s"},children:e.jsx(p,{player:n[0],ranking:1})}),e.jsx("div",{className:"twr-players-ranking-item flex-5",style:{"--transition-in-delay":"0s","--transition-out-delay":"0s"},children:e.jsx(p,{player:n[2],ranking:3})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-8 text-[0.5em] mt-8",children:[e.jsx("div",{className:"space-y-4",children:n.slice(3,10).map((c,d)=>e.jsx("div",{className:"twr-players-ranking-item",style:{"--transition-in-delay":`${((d+1)*.08).toFixed(2)}s`,"--transition-out-delay":"0s"},children:e.jsx(M,{player:c,ranking:d+4})},c.id))}),e.jsx("div",{className:"space-y-4",children:n.slice(10,16).map((c,d)=>e.jsx("div",{className:"twr-players-ranking-item",style:{"--transition-in-delay":`${((d+4)*.08).toFixed(2)}s`,"--transition-out-delay":"0s"},children:e.jsx(M,{player:c,ranking:d+11})},c.id))})]})]}):e.jsx(e.Fragment,{})}const L={"twr-player-ranking":"_twr-player-ranking_102jv_1"};function K({player:t,ranking:s}){var n,c,d;return e.jsxs("div",{className:"relative text-right p-4 rounded-[1em]",style:{background:t.color.primary},children:[e.jsx("div",{className:"absolute -top-4 left-[4em] bottom-0 overflow-hidden",children:e.jsx("img",{src:(n=t.image.portrait)==null?void 0:n.default.url,className:"aspect-[18/25] w-[8em]"})}),e.jsxs("div",{className:"w-full h-[5em] flex items-center justify-between text-white",children:[e.jsx("div",{className:"text-left w-[6em] text-[2em]",children:v(s)}),e.jsx("div",{className:"flex-1 text-[3em] leading-[1em] text-left",children:t.name.display.primary}),e.jsxs("div",{className:"text-[3em] leading-[1em]",children:[e.jsx("p",{children:N((c=t.statistics)==null?void 0:c.point)}),e.jsxs("p",{className:"text-[0.5em] opacity-90",children:["(半莊數: ",((d=t.statistics)==null?void 0:d.matchCount)??0,")"]})]})]})]})}function Q({tournamentId:t}){const{data:s}=w(t),[n,c,d,r,u]=x.useMemo(()=>{const i=((s==null?void 0:s.players)??[]).filter(l=>{var a;return typeof((a=l.statistics)==null?void 0:a.matchCount)<"u"&&l.statistics.matchCount>0});return[i.toSorted((l,a)=>{var m,o;return(((m=a.statistics)==null?void 0:m.point)??0)-(((o=l.statistics)==null?void 0:o.point)??0)}).slice(0,6)??[],i.toSorted((l,a)=>{var m,o;return(((m=a.statistics)==null?void 0:m.ronP)??0)-(((o=l.statistics)==null?void 0:o.ronP)??0)}).slice(0,6)??[],i.toSorted((l,a)=>{var m,o;return(((m=a.statistics)==null?void 0:m.ronPureScoreAvg)??0)-(((o=l.statistics)==null?void 0:o.ronPureScoreAvg)??0)}).slice(0,6)??[],i.toSorted((l,a)=>{var m,o;return(((m=l.statistics)==null?void 0:m.chuckP)??0)-(((o=a.statistics)==null?void 0:o.chuckP)??0)}).slice(0,6)??[],i.toSorted((l,a)=>{var m,o;return(((m=a.statistics)==null?void 0:m.scoreMax)??0)-(((o=l.statistics)==null?void 0:o.scoreMax)??0)}).slice(0,6)??[]]},[s==null?void 0:s.players]);return e.jsxs("div",{className:`w-full h-full flex gap-[1em] items-stretch ${L["twr-player-ranking"]}`,children:[e.jsxs("div",{className:"flex-1 flex flex-col gap-y-1 gap-y-[.5em]",children:[e.jsx("h4",{className:"text-[2em] font-semibold text-center leading-[1em] twr-player-ranking-row",children:"MVP"}),e.jsx("p",{className:"text-center twr-player-ranking-row",children:"積分最高選手"}),e.jsx("div",{className:"flex-1 flex flex-col gap-y-1 text-[0.5em] gap-y-[1em]",children:n.map((i,l)=>e.jsx("div",{className:"twr-player-ranking-row",style:{"--transition-in-delay":`${l*.05}s`},children:e.jsx(K,{player:i,ranking:l+1},i.id)},i.id))})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-2 gap-[1em] twr-player-ranking-row",children:[e.jsxs("div",{className:"space-y-[.5em]",children:[e.jsx("p",{className:"text-center",children:"和了率"}),e.jsx("div",{className:"flex-1 flex flex-col gap-y-1",children:c.map(i=>{var l,a;return e.jsx("div",{className:"relative overflow-hidden flex-1 flex flex-col items-stretch justify-center text-white rounded-lg",style:{background:`${i.color.primary}C0`},children:e.jsxs("div",{className:"flex items-center justify-between px-[.5em] gap-x-[.5em] py-[.25em]",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"leading-[1.2em]",children:i.name.display.primary})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"leading-[1.2em]",children:((a=(l=i.statistics)==null?void 0:l.ronP)==null?void 0:a.toFixed(2))??"0.00"})})]})},i.id)})})]}),e.jsxs("div",{className:"space-y-[.5em]",children:[e.jsx("p",{className:"text-center",children:"平均打點"}),e.jsx("div",{className:"flex-1 flex flex-col gap-y-1",children:d.map(i=>{var l,a;return e.jsx("div",{className:"relative overflow-hidden flex-1 flex flex-col items-stretch justify-center text-white rounded-lg",style:{background:`${i.color.primary}C0`},children:e.jsxs("div",{className:"flex items-center justify-between px-[.5em] gap-x-[.5em] py-[.25em]",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"leading-[1.2em]",children:i.name.display.primary})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"leading-[1.2em]",children:((a=(l=i.statistics)==null?void 0:l.ronPureScoreAvg)==null?void 0:a.toFixed(2))??"0.00"})})]})},i.id)})})]}),e.jsxs("div",{className:"space-y-[.5em]",children:[e.jsx("p",{className:"text-center",children:"銃和率"}),e.jsx("div",{className:"flex-1 flex flex-col gap-y-1",children:r.map(i=>{var l,a;return e.jsx("div",{className:"relative overflow-hidden flex-1 flex flex-col items-stretch justify-center text-white rounded-lg",style:{background:`${i.color.primary}C0`},children:e.jsxs("div",{className:"flex items-center justify-between px-[.5em] gap-x-[.5em] py-[.25em]",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"leading-[1.2em]",children:i.name.display.primary})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"leading-[1.2em]",children:((a=(l=i.statistics)==null?void 0:l.chuckP)==null?void 0:a.toFixed(2))??"0.00"})})]})},i.id)})})]}),e.jsxs("div",{className:"space-y-[.5em]",children:[e.jsx("p",{className:"text-center",children:"最高得點"}),e.jsx("div",{className:"flex-1 flex flex-col gap-y-1",children:u.map(i=>{var l,a;return e.jsx("div",{className:"relative overflow-hidden flex-1 flex flex-col items-stretch justify-center text-white rounded-lg",style:{background:`${i.color.primary}C0`},children:e.jsxs("div",{className:"flex items-center justify-between px-[.5em] gap-x-[.5em] py-[.25em]",children:[e.jsx("div",{className:"flex-1",children:e.jsx("p",{className:"leading-[1.2em]",children:i.name.display.primary})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"leading-[1.2em]",children:((a=(l=i.statistics)==null?void 0:l.scoreMax)==null?void 0:a.toFixed(0))??"0"})})]})},i.id)})})]})]})]})}const V="_item_4obu3_1",$={item:V};function W({player:t}){var s;return e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:(s=t.image.portrait)==null?void 0:s.default.url,className:"w-[72%] ml-[18%]",style:{maskImage:"linear-gradient(to bottom, rgba(0, 0, 0, 1), rgba(0, 0, 0, 1) 75%, rgba(0, 0, 0, 0.05))"}}),e.jsx("h3",{className:"leading-[1em] text-[0.8em] font-kurewa",style:{color:t.color.primary},children:t.name.display.primary})]})}function J(){var c;const{data:t}=D("sakura-league-sticker-for-tshirt"),{data:s}=w((c=t==null?void 0:t.tournament)==null?void 0:c._ref),n=x.useMemo(()=>{var u;if(!t||!(s!=null&&s.playersMap))return null;const d=O(7),r=[];for(const i of d)r.push({date:i,players:((u=t.attendees)==null?void 0:u.filter(({attendOn:l,player:{_ref:a}})=>l.startsWith(i)&&s.playersMap[a]).map(({player:{_ref:l}})=>s.playersMap[l]))??[]});return r},[t,s==null?void 0:s.playersMap]);return!t||!s||!n?e.jsx(e.Fragment,{}):e.jsxs("div",{className:"w-full h-full grid grid-cols-2 grid-rows-4 grid-flow-col gap-[0.5em]",children:[n.map(({date:d,players:r})=>e.jsxs("div",{className:`bg-white/50 rounded-[0.5em] flex items-center ${$.item}`,children:[e.jsxs("div",{className:"w-[4em] text-[1.25em] text-center font-kurewa",children:[e.jsx("p",{children:B(d)}),e.jsxs("p",{children:["(",z(d),")"]})]}),e.jsx("div",{className:"flex-1 grid grid-cols-3",children:r.map(u=>e.jsx("div",{className:"w-[5.5em]",children:e.jsx(W,{player:u},u.id)}))})]},d)),e.jsx("div",{children:e.jsxs("p",{className:`w-full h-full text-center place-content-center text-[1.8em] ${$.item}`,children:["集齊 5 張蓋滿的印花卡",e.jsx("br",{}),"即可換領女雀士應援 T 恤"]})})]})}const ee=({forwardFlag:t,refetchFlag:s,resetFlag:n,auto:c,minute:d,params:r})=>{var S;I("m")||(d==null||d.toString());const u=I("auto")||c,{data:i,refetch:l}=E({queryKey:["tournament",r==null?void 0:r.tournamentId],queryFn:()=>F(r==null?void 0:r.tournamentId),enabled:!!(r!=null&&r.tournamentId),staleTime:5*60*1e3}),[a,m]=x.useState(-1);x.useEffect(()=>{setTimeout(()=>{m(0)},500)},[]);const[o,k]=x.useState(!1),[g,R]=x.useState(t??0),[b,T]=x.useState(s??0),[j,_]=x.useState(n??0),y=x.useMemo(()=>[e.jsx(H,{tournamentId:r==null?void 0:r.tournamentId}),e.jsx(Q,{tournamentId:r==null?void 0:r.tournamentId}),e.jsx(J,{})],[r==null?void 0:r.tournamentId,s]),h=x.useCallback(()=>{o||(m(f=>f+.5),k(!0),setTimeout(()=>{m(f=>Math.ceil(f)%y.length),k(!1)},1200))},[o,y]);x.useEffect(()=>{if(u){const f=setInterval(()=>{h()},8e3);return()=>clearInterval(f)}},[u,h]);const A=x.useCallback(()=>{h()},[h]);return x.useEffect(()=>{typeof t<"u"&&t!==g&&(h(),R(t))},[t,h,g]),x.useEffect(()=>{typeof s<"u"&&s!==b&&(l(),T(s))},[b,j,s,l]),x.useEffect(()=>{typeof n<"u"&&n!==j&&(m(0),_(n))},[t,h,g,j,n]),i?e.jsxs("div",{className:"absolute inset-0 font-kurewa",style:{background:"linear-gradient(to bottom, rgb(255, 217, 227), rgb(255, 192, 203))"},onClick:A,children:[e.jsx("div",{className:"absolute inset-0",children:e.jsx("video",{src:"/videos/ptt-bg3.mp4",className:"absolute inset-0",autoPlay:!0,loop:!0,muted:!0})}),e.jsxs("div",{className:"absolute inset-0 tournament-realtime-report text-[#ec276e] text-[36px] flex py-[1em] px-[1em] gap-x-[1em]",children:[e.jsxs("div",{className:"twr-title flex flex-col justify-start gap-[1em] items-center relative",children:[e.jsx("div",{children:e.jsx("img",{src:((S=i.tournament.image.logo)==null?void 0:S.default.url)??"",alt:i.tournament.name,style:{width:"3.5em",height:"3.5em",marginTop:"0.15em"}})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-center mb-[3.5em] relative",children:[e.jsx("div",{className:`absolute inset-0 flex flex-col items-center justify-center ${C.screenTitle}`,"data-active":a>=0&&a<=1,children:e.jsx("p",{style:{fontSize:"3em",writingMode:"vertical-rl",textOrientation:"upright"},children:"現時數據"})}),e.jsxs("div",{className:`absolute inset-0 flex items-center justify-center ${C.screenTitle}`,"data-active":a===2,children:[e.jsx("p",{className:"whitespace-nowrap self-start font-kurewa mt-[0.5em]",style:{fontSize:"2.2em",lineHeight:"1.1em",letterSpacing:"-0.4em",writingMode:"vertical-rl",textOrientation:"upright"},children:"印花卡活動"}),e.jsx("p",{className:"whitespace-nowrap self-end font-kurewa mb-[0.25em]",style:{fontSize:"2.2em",lineHeight:"1.1em",letterSpacing:"-0.4em",writingMode:"vertical-rl",textOrientation:"upright"},children:"下週當值女選手"})]})]})]}),e.jsx("div",{className:"flex-1 relative",children:y.map((f,P)=>e.jsx("div",{"data-active":P===a,className:"absolute inset-0",children:f},P))})]})]}):e.jsx(e.Fragment,{})};export{ee as default};
